<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Not the game of life</title>
  <script src="jspostcode.js"></script>
  <script src="d3.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Permanent+Marker" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
  <style>
    body {
      font-family: 'Raleway', sans-serif, helvetica, arial;
      background-color: #D6F2E4;
      background-image: url("background_city.jpg");
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      color: grey;
      height: 100%;
    }

    #UniversityChoice {
      display: none;
    }

    #Start {
      left: 50%;
      padding-top: 15%;
      color: white;
      text-shadow: 1px 1px 4px #000000;
      padding-left: 33%;
      padding-right: 33%;
      text-align: center;
    }

    .RedSize {
      font-size: 2.25em;
    }

    #WorkChoice {
      display: none;
    }

    #PercentagePensionInputForm {
      display: none;
    }

    #LineChartDiv {

      width: 100%;
      height: 80%;
    }

    #LineChartDiv svg {
      width: 90%;
      height: 90%;
      padding: 15%;
    }

    #AfterLifeButton {
      display: none;
    }



    text:first-of-type {
      fill: black;
      font-family: sans-serif;
      font-size: 12px;
      text-align: center;
    }

    text:nth-of-type(2) {
      fill: black;
      font-family: sans-serif;
      font-size: 12px;
      text-align: center;
    }

    text:nth-of-type(3) {
      fill: black;
      font-family: sans-serif;
      font-size: 12px;
      text-align: center;
    }

    h1 {
      text-align: center;
      font-family: 'Permanent Marker', cursive;
      font-size: 5em;
    }

    h2 {
      text-align: center;
    }

    #EducationChartTitle {
      color: grey;
      text-align: center;
      font-style: oblique;
      margin-top: 5;
      margin-bottom: 5;
    }

    #BeforeGCSEResults {
      display: none;
    }

    #MarriedChoice {
      display: none;
    }

    #WeddingPrice {
      display: none;
    }

    #LifeEvent {
      display: none;
      text-align: center;
      font-size: 2.25em;
      font-style: oblique;
    }

    #LifeChoice {
      display: none;
      font-style: oblique;
      text-align: center;
      font-size: 2.25em;
    }

    #AgeRed {
      position: relative;
      background: url('age.png') top center no-repeat;
      background-size: contain;
      text-align: center;
      padding: 7px;
      width: 20%;
    }
    #AgeRed p{
      font-size: 0.8em;
      padding-top: 4px;
      margin-bottom: 2px;
    }
    #AgeRed2 {
      color: #CC3529;
      font-size: 2em;
      margin: 3px;
    }

    #Left2 {
      display: none;
      color: white;
      position: relative;
      background-size: contain;
      background: url('bank1.png') top center no-repeat;
      margin: 0 auto;
      width: 30%;
      left: 5%;
      font-size: 1.2em;
      margin-top: 5%;

    }
    #Left2::after {
      padding-top: 66.4%;
      display: inline-block;
      content: '';
    }

    #Left {
      width: 50%;
      padding-top: 20%;
      padding-right: 25%;
      padding-left: 25%;
      margin-top: 10%;
    }

    #PercentagePensionInputForm {
      width: 50%;
      padding-top: 10%;
      padding-right: 25%;
      padding-left: 25%;
      margin-top: 10%;
    }
    #FamilyDiv {
      color: #262626;
      border-style: solid;
      border-color: white;
      border-width: 0px;
      border-radius: 15px;
      margin-left: 5%;
      left: 50%;
      width: 40%;
      display: none;
      vertical-align:top;
    }

    #YouDiv {
      background-color: #F4989D;
      color: 	white;
      width: 100%;
      border-width: 0px;
      border-radius: 10px;
      margin-bottom: 5px;
      padding: 10px;
    }


    #YouText {
      display: inline-block;
      vertical-align: top;
      font-size: 1.2em;
      width: 70%;
      padding-left: 4px;
      margin-top: 20px;
    }

    #YouImg {
      display: inline-block;
      vertical-align: top;
      width: 18%;
    }

    #SpouseText {
      display: inline-block;
      vertical-align: top;
      font-size: 1.2em;
      width: 70%;
      padding-left: 4px;
      margin-top: 20px;
    }

    #SpouseImg {
      display: inline-block;
      vertical-align: top;
      margin-top: 25px;
      width: 18%;
    }



    #SpouseDiv {
      color: white;
      width: 100%;
      border-width: 0px;
      border-radius: 15px;
      margin-bottom: 5px;
      padding: 10px;
    }

    #Child1Div {
      color: white;
      width: 100%;
      border-width: 0px;
      border-radius: 15px;
      margin-bottom: 5px;
      padding: 10px;
      font-size: 1.2em;
    }
    #Child2Div {
      color: white;
      width: 100%;
      border-width: 0px;
      border-radius: 15px;
      margin-bottom: 5px;
      padding: 10px;
      font-size: 1.2em;
    }
    #Child3Div {
      color: white;
      width: 100%;
      border-width: 0px;
      border-radius: 15px;
      margin-bottom: 5px;
      padding: 10px;
      font-size: 1.2em;
    }

    #EstateAgents {
      display: none;
    }

    #postcode {
      padding: 5px;
      border-radius: 15px;
      font-size: 2em;
      width: 50%;
    }

    #FButton {
      background-color: #F4989D;
      font-size: 2em;
      color: white;
      border: none;
      border-radius: 15px;
      width: 22%;
      padding-top: 5px;
      padding-bottom: 5px;
      text-align: center;
      box-shadow: 2px 2px 3px #AF6F70;
    }

    #MButton {
      background-color: #75D1F6;
      font-size: 2em;
      color: white;
      border: none;
      border-radius: 15px;
      width: 22%;
      padding-top: 5px;
      padding-bottom: 5px;
      text-align: center;
      box-shadow: 2px 2px 3px #388CA6;
    }

    #SButton {
      background-color: #F78E55;
      font-family: 'Permanent Marker', cursive;
      color: white;
      border: none;
      font-size: 2em;
      text-align: center;
      border-radius: 15px;
      width: 100%;
      padding: 15px 15px;
      text-align: center;
      box-shadow: 2px 2px 3px #A56539;
    }

    #SButtonDiv {
      display: inline-block;
    }

    #StartInputs {

    }

    .black_overlay {
      display: none;
      position: absolute;
      top: 0%;
      left: 0%;
      width: 100%;
      height: 100%;
      background-color: black;
      z-index: 1001;
      -moz-opacity: 0.8;
      opacity: .30;
      filter: alpha(opacity=80);
    }

    .white_content {
      display: none;
      position: absolute;
      top: 25%;
      left: 23%;
      width: 46%;

      padding: 16px;
      border: 16px solid white;
      background-color: white;
      z-index: 1002;
      overflow: auto;
      color: black;
    }

    .white_information {
      display: none;
      position: absolute;
      top: 25%;
      left: 75%;
      width: 20%;

      padding: 16px;
      border: 16px solid white;
      background-color: white;
      z-index: 1002;
      overflow: auto;
      color: black;
    }

    #ChartAreaDiv svg {
      width: 100%;
    }

    #ChartAreaDiv2 svg {
      width: 100%;
    }
    #ChartAreaDiv3 svg {
      width: 100%;
    }
    #AfterLifeContainer {
      display: none;
      padding-left: 20%;
      padding-right: 20%;
      width: 60%;
      height: 100%;
    }

    .AfterLife_overlay {
      background-color: white;
      padding: 20px;
    }

    .AfterLife_IMG {
      padding-left: 45%;
    }

    .y_axis.axis line {
      stroke: black;
    }

    .tick text {
      color: black;
      fill: black;
      style: bold;
    }

    .tick line {
      stroke: black;
      opacity: 0;
    }

    div {
      margin-bottom: 20px;
    }

    .ExpenseColour {
      color: LightCoral;
    }

    .IncomeColour {
      color: LightGreen;
    }

    #ProgressBar {
      display: flex;
      justify-content: space-between;
      position: fixed;
      bottom: 0;
      height: 10%;
      width: 90%;
      padding-left: 5%;
      padding-right: 5%;
    }

    #SchoolLogo {
      visibility: hidden;
    }
    #UniLogo{
      visibility: hidden;
    }
    #WorkLogo{
      visibility: hidden;
    }
    #KidsLogo{
      visibility: hidden;
    }
    #HouseLogo{
      visibility: hidden;
    }
    #WeddingLogo{
      visibility: hidden;
    }
    #DeadLogo{
      visibility: hidden;
    }
  </style>
</head>

<body>
  <div id='Left2'>
    <div id='Left'>
      <div id='Expenses'>
      </div>
    </div>
    <div id='PercentagePensionInputForm'>
      <form>
        Percentage of salary go towards pension:
        <input id='PercentagePensionInput' type="number" placeholder=3 value=3 name="quantity" min=3 max=100>%
      </form>
    </div>
  </div>
  <div id='FamilyDiv'>
    <div id='AgeRed'>
      <p>My Age</p>
      <div id='AgeRed2'>11</div>
    </div>
    <div id='YouDiv'>
      <img id='YouImg' src=''>
      <div id='YouText'></div>
    </div>
    <div id='SpouseDiv'>
      <img id="SpouseImg" src=''>
      <div id='SpouseText'></div>
    </div>
    <div id='Child1Div'>
    </div>
    <div id='Child2Div'>
    </div>
    <div id='Child3Div'>
    </div>
  </div>
  <div id='Right'>


    <div id='Start'>
      <h1 style="margin-bottom: 10px;"><span style="font-family: 'Press Start 2P', cursive; font-size: 0.6em;">Stats</span> Life!</h1>
      <p>Choose your gender and location to start you life...</p>
      <div id="StartInputs">
      <button name="Male" type="button" id="MButton" onclick="ButtonMale();">♂</button>
      <button name="Female" type="button" id="FButton" onclick="ButtonFemale();">♀</button>
      <input type="text" placeholder="Enter Postcode" id="postcode" maxlength="13" alt="Enter Postcode">
    </div>
    <div id="SButtonDiv">
        <button name="Start" type="button" id="SButton" onclick="testPostCode();">START LIFE</button>
    </div>
    </div>


    <div id='EducationAlert'>
    </div>
    <div id='Education'>
    </div>
    <div id='Education2'>
    </div>
    <div id='Education3'>
    </div>
    <div id='Education4'>
    </div>


    <div id='WorkWage'>
    </div>
  </div>


  <div id='RetireButton'>
  </div>
  <div id='AgeNow'>
  </div>
  <div id="Information" class="white_information">

  </div>
  <div id="light" class="white_content">

    <div id="LifeEvent">
      <p>
        Life Event
      </p>
    </div>
    <div id="PopOutContent">
    </div>
    <button name="Continue" id="AfterLifeButton" type="button" onclick="AfterLife(); document.getElementById('Information').style.display='none';document.getElementById('light').style.display='none';document.getElementById('ExpensesTooHigh').style.display='none';document.getElementById('EstateAgents').style.display='none';document.getElementById('LifeEvent').style.display='none';document.getElementById('LifeChoice').style.display='none';document.getElementById('fade').style.display='none';document.getElementById('AfterLifeContainer').style.display='block';document.getElementById('FamilyDiv').style.display='none';document.getElementById('Left2').style.display='none';document.getElementById('ProgressBar').style.display='none';">Continue</button>
    <div id="LifeChoice">
      <p>
        Life Choice
      </p>
    </div>
    <div id='LineChartDiv'>

    </div>
    <div id='UniversityChoice'>
      <p>Would you like to apply to university?
        <select name="ApplyUni" id="ApplyUni">
    <option value="Blank"></option>
    <option value="Yes">Yes</option>
    <option value="No">No</option>
    </select>
        <button name="Continue" type="button" onclick="StartUniversity(); StartLife();document.getElementById('ExpensesTooHigh').style.display='none';document.getElementById('EstateAgents').style.display='none';document.getElementById('LifeEvent').style.display='none';document.getElementById('LifeChoice').style.display='none';document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">Continue</button>
      </p>
    </div>
    <div id='BeforeGCSEResults'>
      <p>You are about to get your GCSE results...
        <button name="Continue" type="button" onclick="KS4Destination();">Continue</button>
      </p>
    </div>
    <div id='MarriedChoice'>
      <p>You've met an amazing
        <select name="MarriedSpouseGender" id="MarriedSpouseGender">
    <option value="Male">man</option>
    <option value="Female">woman</option>
    </select> would you like to get married?
        <button name="Yes" type="button" onclick="Wedding();">Yes</button>
        <button name="No" type="button" onclick="DontMarry();document.getElementById('ExpensesTooHigh').style.display='none';document.getElementById('LifeEvent').style.display='none';document.getElementById('EstateAgents').style.display='none';document.getElementById('LifeChoice').style.display='none';document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">No</button>
      </p>
    </div>

    <div id='WorkChoice'>
      <p>
        Which job field would you like to apply to?
        <select id="WorkDropDown" name="WorkDropDown"></select>
        <button name="Apply" type="button" onclick="StartWork();StartLife();document.getElementById('LifeEvent').style.display='none';document.getElementById('ExpensesTooHigh').style.display='none';document.getElementById('EstateAgents').style.display='none';document.getElementById('LifeChoice').style.display='none';document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">Apply</button>
      </p>
    </div>
    <div id='EstateAgents'>
      <div id='ExpensesTooHigh'>
        <p>
          Your expenses are too high, you need to move house!
        </p>
      </div>
      <div id='RentChoice'>
        <p>
          <b>Choose a house to rent:</b>
        </p>
        <select id="RentDropDown" name="WorkDropDown"></select>
      </div>
    </div>

    <p id="EducationChartTitle">
      <b>WHERE PEOPLE ARE 6 MONTHS AFTER GCSEs IN YOUR AREA (Figures in %)</b>
    </p>
    <div id="ChartAreaDiv">
    </div>
    <div id="ChartAreaDiv2">
    </div>
    <div id='WeddingPrice'>
      <form>
        The majority of couples spend between £5,000 and £10,000 on their wedding, how much do you want to spend on your yours?<br> £
        <input id='WeddingPriceInput' type="number" placeholder=50 name="quantity" min=50 value=50>
      </form>
      <button name="Continue" type="button" onclick="GetMarried();document.getElementById('LifeEvent').style.display='none';document.getElementById('ExpensesTooHigh').style.display='none';document.getElementById('EstateAgents').style.display='none';document.getElementById('LifeChoice').style.display='none';document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'">Yes</button>
    </div>
    <button id="TheContinueButton" name="Start" type="button" onclick="StartLife();document.getElementById('Information').style.display='none';document.getElementById('light').style.display='none';document.getElementById('ExpensesTooHigh').style.display='none';document.getElementById('EstateAgents').style.display='none';document.getElementById('LifeEvent').style.display='none';document.getElementById('LifeChoice').style.display='none';document.getElementById('fade').style.display='none'">Continue</button>
  </div>
  <div id="fade" class="black_overlay"></div>
  <div id="AfterLifeContainer">
    <div id="AfterLifeIntro"><h1>Welcome to the After Life & Game Summary</h1></div>
    <div id="AfterLifeEducation" class="AfterLife_overlay">
      <div id="AfterLifeEducationImg" class="AfterLife_IMG">
        <img  width="20%" src="school.png">
      </div>
      <div id="AfterLifeEducationText">
        <h2>Early Education</h2>
        <p>The education levels accross the country vary a lot from place to place. Even without realising it, when you first step into school the chances of doing well or poorly in school are already thrown based on your location alone. Of course whether you did your homework is your decision - but it still doesn't change the fact that where you live can give you a head start at school, or hold you back.</p>
        <h3>Location 6 Months After GCSEs in England & Wales (Figures in %)</h3>
        <div id="ChartAreaDiv3"></div>
        <h3>Location 6 Months After GCSEs in Your Area (Figures in %)</h3>
      </div>
    </div>
    <div id="AfterLifeUni" class="AfterLife_overlay">
      <div id="AfterLifeUniImg" class="AfterLife_IMG">
        <img  width="20%" src="uni.png">
      </div>
      <h2>Further Education</h2>
      <div id="AfterLifeUniText"></div>
    </div>
    <div id="AfterLifeWork" class="AfterLife_overlay">
      <div id="AfterLifeWorkImg" class="AfterLife_IMG">
        <img  width="20%" src="work.png">
      </div>
      <h2>Your Working Life</h2>
      <div id="AfterLifeWorkTextArea"></div>
      <h3>The Gender Difference in Pay For Your Job by Age (£)</h3>
      <div id="AfterLifeWorkTextAreaGraph"></div>
      <div id="AfterLifeWorkTextGender"></div>
    </div>
    <div id="AfterLifeHouse" class="AfterLife_overlay">
      <div id="AfterLifeHouseImg" class="AfterLife_IMG">
        <img width="20%" src="house.png">
      </div>
      <h2>Housing</h2>
      <div id="AfterLifeHouseText"></div>
    </div>
    <div id="AfterLifeDeath" class="AfterLife_overlay">
      <div id="AfterLifeDeathImg" class="AfterLife_IMG">
        <img width="20%" src="dead.png">
      </div>
      <h2>Death</h2>
      <div id="AfterLifeDeathText">Your chance of death at a certain age by a certain cause is determined by two things. First being</div>
    </div>
    <div id="GameOver" class="AfterLife_overlay">
      <h1 style="font-family: 'Press Start 2P', cursive; font-size: 2em; color: #CC3529;">GAME OVER</h1>
      <p>Thank you for playing through Stats Life! Hopefully it has given you something to think about how our own geographical location can tips the odds against or for us in life.<br><br>This project was built on open data mostly from the ONS website from datasets based around 2015. From births, to marriages to death, every step that wasn't in your control was based on chance from real life data.</p>
    </div>
  </div>
  <div id="ProgressBar">
    <img height="100%" src="school.png" id="SchoolLogo">
    <img height="100%" src="uni.png" id="UniLogo">
    <img height="100%" src="work.png" id="WorkLogo">
    <img height="100%" src="house.png" id="HouseLogo">
    <img height="100%" src="kids.png" id="KidsLogo">
    <img height="100%" src="wedding.png" id="WeddingLogo">
    <img height="100%" src="dead.png" id="DeadLogo">
  </div>
  <script>
    var Paused = false;
    var xhr = new XMLHttpRequest();
    var newPostcode = '';
    var LSOA = '';
    var LA = '';
    var Region = '';
    var Gender = 'Female';
    var IMD = '';
    var FinalAgeDeath = '';
    var EducationLevel = 0;
    var GCSEPass = '';
    var UniPoints = 0;
    var Job = 'No';
    var Salary = 0;
    var Salary10 = 0;
    var AdminDistrict = '';
    var Blocker = '';
    var AdminDistrictName = '';
    var AdminDistrictWard = '';
    var Savings = 0;
    var Remaining = 0;
    var WentToUniversity = false;
    var StudentLoanTotal = 44500;
    var StudentLoanFinished = false;
    var EducationWidth = 0;
    var Country = '';

    var ageRange = '';
    var CauseOfDeath = '';
    var LevelTwoChance = '';

    //Working out expenses and quintileband
    var FamilySize = '1Adult';
    var QuintileBand = 0;
    var Income = 0;
    var Expenses = 0;
    var PopOutWait = false;
    var PopOutWait2 = false;

    //TypesDeath
    var Neoplasms = '';
    var Respiratory = '';
    var Diabetes = '';
    var HeartDisease = '';
    var Stroke = '';
    var OtherCirculatory = '';
    var IntentionalInjuries = '';
    var UnintentionalInjuries = '';
    var OtherCauses = '';
    var Neonatal = '';
    var Rent = '';
    var WageAfterTax = 0;
    var SpouseWageAfterTax = 0;

    //Rent value for each number of bedrooms.
    var IsRent0Option = false;
    var Rent0 = '';
    var Rent1 = '';
    var Rent2 = '';
    var Rent3 = '';
    var Rent4 = '';
    var CouncilTax = 0;
    var rentFilter = '';
    var RentCostData1 = '';

    // doughnut is age hehe
    var doughnut = 12;

    //PensionFunds
    var maxPercentagePension = 3;
    var spouseMaxPercentagePension = 3;
    var YearlyPensionContribution = 0;
    var SpouseyearlyPensionContribution = 0;
    var PensionPot = 0;
    var SpousePensionPot = 0;
    var blocker2 = 0;
    var Spouseblocker2 = 0;
    var blocker3 = 0;
    var Blocker4 = 0;
    var RetirementTrue = false;
    var SpouseRetirementTrue = false;
    var PensionPerYear = 0;
    var SpousePensionPerYear = 0;
    var Oxbridge = '';
    var TopThirdHEI = '';
    var OtherHE = '';
    var WageDifference = 0;

    var YearsLeft = 0;
    var PensionPerYearAfterTax = 0;
    var SpousePensionPerYearAfterTax = 0;

    var MarriageAge = 101;
    //var MarriageAge = 22;
    var Married = false;

    //EmptyChildVariable
    var howManyChildren = 0;
    var howManyDependantChildren = 0;
    var Child1Doughnut = '';
    var Child2Doughnut = '';
    var Child3Doughnut = '';
    var Name = '';
    var Child1Name = '';
    var Child2Name = '';
    var Child3Name = '';
    var Child1Gender = '';
    var Child2Gender = '';
    var Child3Gender = '';
    var Child1Dependant = false;
    var Child2Dependant = false;
    var Child3Dependant = false;

    var SpouseGender = '';
    var SpouseName = '';
    var SpouseWage = 0;
    var SpouseOccupation = '';
    var SpouseJobCSV = '';
    var InformationDisplay = false;

    var ButtonMale = function(){
      Gender = 'Male';
      document.getElementById("YouDiv").style.backgroundColor = "#75D1F6";
      document.getElementById("YouDiv").style.boxShadow = "2px 2px 3px #388CA6";
      document.getElementById("YouImg").src = "man.png";
    };

    var ButtonFemale = function(){
      Gender = 'Female';
      document.getElementById("YouDiv").style.backgroundColor = "#F4989D";
      document.getElementById("YouDiv").style.boxShadow = "2px 2px 3px #AF6F70";
      document.getElementById("YouImg").src = "girl.png"
    };

    var PauseLife = function() {
      Paused = true;
    };
    var StartLife = function() {
      InformationDisplay = false;
      Paused = false;
      console.log(PopOutWait);
      if (PopOutWait === true) {
        Work();
        PopOutWait = false;
      }
      if (PopOutWait2 === true){
        PassUni();
        PopOutWait2 = false;
      };
    };
    var LifeEvent = function() {
      document.getElementById('LifeEvent').style.display = 'block';

      PopOut();

    }
    var LifeChoice = function() {
      document.getElementById('LifeChoice').style.display = 'block';
      PopOut();
    }
    var PopOut = function() {
      PauseLife();
      document.getElementById('light').style.display = 'block';
      document.getElementById('fade').style.display = 'block';
      if (InformationDisplay == true) {
        document.getElementById('Information').style.display = 'block';
      }
    };

    var numberComma = function(x) {
      return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    };

    // Function tests postcode is valid and creates the newPostcode and stores the Gender variables
    function testPostCode() {
      var newPostCode = checkPostCode(document.getElementById('postcode').value);
      if (newPostCode) {
        document.getElementById('postcode').value = newPostCode;
        console.log(newPostCode);
        //Gender = document.getElementById('Gender').value;
        PostcodeSearch();
      } else alert("Postcode must be 6 Characters Long");
    }

    //Searching for postcode on API to get LA and LSOA
    var PostcodeSearch = function() {
      var newPostCode = checkPostCode(document.getElementById('postcode').value);
      newPostCode = newPostCode.replace(/\s+/g, '');
      var url = 'https://api.postcodes.io/postcodes/' + newPostCode;
      console.log(url)
      xhr.open("GET", url);
      xhr.addEventListener('load', processResponse);
      xhr.send();
    };

    //Process API response and store LA and LSOA data.
    var processResponse = function() {
      var data = JSON.parse(this.response);
      console.log(data);
      LSOA = data.result.lsoa;
      console.log(LSOA);
      LA = data.result.admin_county;
      AdminDistrict = data.result.codes.admin_district;
      AdminDistrictName = data.result.admin_district;
      AdminDistrictWard = data.result.admin_ward;
      Region = data.result.region;
      Country = data.result.country;
      if (LA === null) {
        LA = data.result.admin_district;
      };
      if (Region === null) {
        Region = data.result.country;
      };
      console.log(LA);
      getIMD();
    };

    var getIMD = function() {
      console.log('I am checking:');
      console.log('Local Authority: ' + LA);
      console.log('Gender: ' + Gender);

      //Finds the economic depravation based on the LSOA
      d3.csv("IMDbyLSOA.csv", function(IMDData) {
        //console.log("IMDData: ", IMDData);
        // If LSOA in .csv matches the LSOA variable then get its IMd
        IMD = IMDData.filter(function(d) {
          return d.LSOA === LSOA
        })[0].IMD;
        console.log('IMD: ' + IMD);
        agedeath();
        AgeMarriage();
      });
    };

    //Random Number Range
    var randomFromTo = function(from, to) {
      return Math.floor(Math.random() * (to - from + 1) + from);
    }

    //Finds the appropriate number for gender and IMD at each age range
    var agedeath = function() {
      d3.csv("AgeDeath.csv", function(AgeDeathData) {
        var Help2 = (IMD + Gender);
        console.log(Help2);
        var lessThan1 = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].lessThan1;
        var OneToFour = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].OneToFour;
        var FiveToNine = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].FiveToNine;
        var TenToFourteen = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].TenToFourteen;
        var FifteenToNineteen = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].FifteenToNineteen;
        var TwentyToTwentyfour = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].TwentyToTwentyfour;
        var TwentyfiveToTwentyNine = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].TwentyfiveToTwentyNine;
        var ThirtyToThirtyfour = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].ThirtyToThirtyfour;
        var ThirtyfiveToThirtynine = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].ThirtyfiveToThirtynine;
        var FourtyToFourtyfour = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].FourtyToFourtyfour;
        var FourtyfiveToFourtynine = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].FourtyfiveToFourtynine;
        var FiftyToFiftyfour = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].FiftyToFiftyfour;
        var FiftyfiveToFiftyNine = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].FiftyfiveToFiftyNine;
        var SixtyToSixtyfour = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].SixtyToSixtyfour;
        var SixtyfiveToSixtynine = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].SixtyfiveToSixtynine;
        var SeventyToSeventyfour = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].SeventyToSeventyfour;
        var SeventyfiveToSeventynine = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].SeventyfiveToSeventynine;
        var EightyToEightyfour = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].EightyToEightyfour;
        var EightyfiveToEightynine = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].EightyfiveToEightynine;
        var Ninety = AgeDeathData.filter(function(d) {
          return d.Helper === Help2
        })[0].Ninety;

        //From the numbers decides which range the person will die in.
        //Also chooses a random from within that age as the cause.

        var chance = Math.floor((Math.random() * 100) + 1);
        if (chance <= lessThan1) {
          console.log('lessThan1');
          FinalAgeDeath = 'less than 1';
          console.log(FinalAgeDeath);
          ageRange = 'lessThan1';
        } else if (chance <= OneToFour) {
          console.log('OneToFour');
          FinalAgeDeath = randomFromTo(1, 4);
          console.log(FinalAgeDeath);
          ageRange = 'OneToFour';
        } else if (chance <= FiveToNine) {
          console.log('FiveToNine')
          FinalAgeDeath = randomFromTo(5, 9);
          console.log(FinalAgeDeath);
          ageRange = 'FiveToNine';
        } else if (chance <= TenToFourteen) {
          console.log('TenToFourteen')
          FinalAgeDeath = randomFromTo(10, 14);
          console.log(FinalAgeDeath);
          ageRange = 'TenToFourteen';
        } else if (chance <= FifteenToNineteen) {
          console.log('FifteenToNineteen')
          FinalAgeDeath = randomFromTo(15, 19);
          console.log(FinalAgeDeath);
          ageRange = 'FifteenToNineteen';
        } else if (chance <= TwentyToTwentyfour) {
          console.log('TwentyToTwentyfour')
          FinalAgeDeath = randomFromTo(20, 24);
          console.log(FinalAgeDeath);
          ageRange = 'TwentyToTwentyfour';
        } else if (chance <= TwentyfiveToTwentyNine) {
          console.log('TwentyfiveToTwentyNine')
          FinalAgeDeath = randomFromTo(25, 29);
          console.log(FinalAgeDeath);
          ageRange = 'TwentyfiveToTwentyNine';
        } else if (chance <= ThirtyToThirtyfour) {
          console.log('ThirtyToThirtyfour')
          FinalAgeDeath = randomFromTo(30, 34);
          console.log(FinalAgeDeath);
          ageRange = 'ThirtyToThirtyfour';
        } else if (chance <= ThirtyfiveToThirtynine) {
          console.log('ThirtyfiveToThirtynine')
          FinalAgeDeath = randomFromTo(35, 39);
          console.log(FinalAgeDeath);
          ageRange = 'ThirtyfiveToThirtynine';
        } else if (chance <= FourtyToFourtyfour) {
          console.log('FourtyToFourtyfour')
          FinalAgeDeath = randomFromTo(40, 44);
          console.log(FinalAgeDeath);
          ageRange = 'FourtyToFourtyfour';
        } else if (chance <= FourtyfiveToFourtynine) {
          console.log('FourtyfiveToFourtynine')
          FinalAgeDeath = randomFromTo(45, 49);
          console.log(FinalAgeDeath);
          ageRange = 'FourtyfiveToFourtynine';
        } else if (chance <= FiftyToFiftyfour) {
          console.log('FiftyToFiftyfour')
          FinalAgeDeath = randomFromTo(50, 54);
          console.log(FinalAgeDeath);
          ageRange = 'FiftyToFiftyfour';
        } else if (chance <= FiftyfiveToFiftyNine) {
          console.log('FiftyfiveToFiftyNine')
          FinalAgeDeath = randomFromTo(55, 59);
          console.log(FinalAgeDeath);
          ageRange = 'FiftyfiveToFiftyNine';
        } else if (chance <= SixtyToSixtyfour) {
          console.log('SixtyToSixtyfour')
          FinalAgeDeath = randomFromTo(60, 64);
          console.log(FinalAgeDeath);
          ageRange = 'SixtyToSixtyfour';
        } else if (chance <= SixtyfiveToSixtynine) {
          console.log('SixtyfiveToSixtynine')
          FinalAgeDeath = randomFromTo(65, 69);
          console.log(FinalAgeDeath);
          ageRange = 'SixtyfiveToSixtynine';
        } else if (chance <= SeventyToSeventyfour) {
          console.log('SeventyToSeventyfour')
          FinalAgeDeath = randomFromTo(70, 74);
          console.log(FinalAgeDeath);
          ageRange = 'SeventyToSeventyfour';
        } else if (chance <= SeventyfiveToSeventynine) {
          console.log('SeventyfiveToSeventynine')
          FinalAgeDeath = randomFromTo(75, 79);
          console.log(FinalAgeDeath);
          ageRange = 'SeventyfiveToSeventynine';
        } else if (chance <= EightyToEightyfour) {
          console.log('EightyToEightyfour')
          FinalAgeDeath = randomFromTo(80, 84);
          console.log(FinalAgeDeath);
          ageRange = 'EightyToEightyfour';
        } else if (chance <= EightyfiveToEightynine) {
          console.log('EightyfiveToEightynine')
          FinalAgeDeath = randomFromTo(85, 89);
          console.log(FinalAgeDeath);
          ageRange = 'EightyfiveToEightynine';
        } else {
          console.log('Ninety')
          FinalAgeDeath = randomFromTo(90, 100);
          console.log(FinalAgeDeath);
          ageRange = 'Ninety';
        };
        CauseDeath();
      });
    };
    //Based on help (gender and IMD) and age of death find chance for each death
    var CauseDeath = function() {
      d3.csv("CauseDeath2.csv", function(CauseDeathData) {
        var Help2 = (IMD + Gender);
        console.log(Help2);
        console.log(ageRange);
        var filteredData = CauseDeathData.filter(function(d) {
          if ((d['Age'] === ageRange) && (d['Help'] === Help2)) {
            return d;
          };
        });
        console.log(filteredData);
        Neoplasms = filteredData[0]['01 Neoplasms'];
        Respiratory = filteredData[0]['02 Diseases of the respiratory system'];
        Diabetes = filteredData[0]['03 Diabetes'];
        HeartDisease = filteredData[0]['04 Ischaemic heart disease'];
        Stroke = filteredData[0]['05 Stroke (cerebrovascular)'];
        OtherCirculatory = filteredData[0]['06 Other circulatory'];
        IntentionalInjuries = filteredData[0]['07 Intentional injuries'];
        UnintentionalInjuries = filteredData[0]['08 Unintentional injuries'];
        OtherCauses = filteredData[0]['09 All other causes'];
        Neonatal = filteredData[0]['10 Neonatal'];

        Neoplasms = Number(Neoplasms);
        Respiratory = Number(Respiratory);
        Diabetes = Number(Diabetes);
        HeartDisease = Number(HeartDisease);
        Stroke = Number(Stroke);
        OtherCirculatory = Number(OtherCirculatory);
        IntentionalInjuries = Number(IntentionalInjuries);
        UnintentionalInjuries = Number(UnintentionalInjuries);
        OtherCauses = Number(OtherCauses);
        Neonatal = Number(Neonatal);
        CauseDeathChance();
      });
    };

    //Find the chance of you dying from different causes.
    var CauseDeathChance = function() {
      var chance = Math.floor((Math.random() * 100) + 1);
      console.log(chance);
      if (chance <= Neoplasms) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'Cancer');
        CauseOfDeath = 'cancer';
      } else if (chance <= Respiratory) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'Diseases of the Respiratory');
        CauseOfDeath = 'diseases of the respiratory system';
      } else if (chance <= Diabetes) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'Diabetes');
        CauseOfDeath = 'diabetes';
      } else if (chance <= HeartDisease) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'HeartDisease');
        CauseOfDeath = 'heart disease';
      } else if (chance <= Stroke) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'Stroke');
        CauseOfDeath = 'stroke';
      } else if (chance <= OtherCirculatory) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'OtherCirculatory');
        CauseOfDeath = 'other circulatory';
      } else if (chance <= IntentionalInjuries) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'IntentionalInjuries');
        CauseOfDeath = 'intentional injuries';
      } else if (chance <= UnintentionalInjuries) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'UnintentionalInjuries');
        CauseOfDeath = 'unintentional injuries';
      } else if (chance <= OtherCauses) {
        console.log('You were ' + FinalAgeDeath + ' years old when you died from ' + 'Other');
        CauseOfDeath = 'other causes, how mysterious';
      } else if (chance <= Neonatal) {
        console.log('You were ' + FinalAgeDeath + 'years old when you died from ' + 'Neonatal');
        CauseOfDeath = 'neonatal';
      } else {
        console.log('Abort');
      };
      add();
    };

    //Start timer of life which ends when dead.
    //If you reach death age the timer will stop, when you are 16 it'll pause for education.
    var add = function() {

      document.getElementById("Start").style.display = "none"
      document.body.style.backgroundImage = "url('background.jpg')";
      document.getElementById("FamilyDiv").style.display = "inline-block";
      document.getElementById("Left2").style.display = "inline-block";
      document.getElementById("PercentagePensionInputForm").style.visibility = "hidden";
      document.getElementById("PercentagePensionInputForm").style.display = "block";
      window.setInterval(
        function() {
          if (Paused != true && blocker3 != 1) {
            familyDivFunction();
            if (doughnut == FinalAgeDeath && blocker3 == 0) {
              blocker3 = 1;
              document.getElementById("TheContinueButton").style.display = "none";
              document.getElementById("AfterLifeButton").style.display = "block";
              document.getElementById("DeadLogo").style.visibility = 'visible';
              document.getElementById("PopOutContent").innerHTML = "You died at " + doughnut + " years old from " + CauseOfDeath + '.';
              LifeEvent();
              Paused = true;
            }
            //Stop timer at 16 to find out what happens at KS4.
            else if (doughnut == 16) {
              KS4();
            } else if (doughnut == 17) {
              //Make empty before results at 18.
              document.getElementById("ChartAreaDiv").style.display = "none";
              document.getElementById("EducationChartTitle").innerHTML = "";
              document.getElementById("SchoolLogo").style.visibility = 'visible';
              doughnut = doughnut + 1;
            }
            //Stop timer at 18 to give job and university options depending on grades and GCSE.
            else if (doughnut == 18 && GCSEPass == true) {
              document.getElementById("UniversityChoice").style.display = "block";
              document.getElementById("TheContinueButton").style.display = "none";
              document.getElementById("PopOutContent").innerHTML = "";
              LifeChoice();
              //doughnut = doughnut + 1;
            } else if (doughnut == 18 && GCSEPass == false && Blocker != 1) {
              PopOutWait = true;
              document.getElementById("PopOutContent").innerHTML = "Because of your GCSE grades holding you back, you don't go to university. <br><br>It is time for you to look for a job.";
              LifeEvent();
              Blocker = 1;
            } else if (doughnut >= 18 && Job != 'No' && Job != 'Student' && RetirementTrue != true) {
              doughnut = doughnut + 1;
              BabyChance();
              MarriageChanceCheck();
              CheckSalary();
              HousingCost();
              CheckFamilySize();
              TaxCalculator();
              PensionFunds();
              if (((doughnut - 1) % 10) == 0 && doughnut != 21 || Remaining < 0 && Rent != 0 && Savings < 0) {
                VisitEstateAgents();
              };
              Rent = parseInt(Rent);
              if (SpouseRetirementTrue == true) {
                SpouseWageAfterTax = SpousePensionPerYearAfterTax;
                if (doughnut != FinalAgeDeath) {
                  SpousePensionPot = SpousePensionPot - (SpousePensionPot / (FinalAgeDeath - doughnut));
                }
              } else if (SpouseRetirementTrue == false && Married == true) {
                CheckSpouseSalary();
                SpouseTaxCalculator();
                SpousePensionFunds();
              }
              CouncilTax = parseInt(CouncilTax);
              console.log(CouncilTax + 'COUUUNCCILLLLL TAAAAAX');
              if (Married == true) {
                var HouseholdIncome = WageAfterTax + SpouseWageAfterTax;
              } else if (Married == false) {
                var HouseholdIncome = WageAfterTax
              }
              Remaining = HouseholdIncome - (Rent + Expenses);

              if (Rent>0){
                document.getElementById("HouseLogo").style.visibility = 'visible';
              }

              if (Rent==0){
                document.getElementById("HouseLogo").style.visibility = 'hidden';
              }
              parseInt(Remaining);
              if (typeof Remaining === 'number' && (Remaining % 1) === 0) {
                Savings = Savings + Remaining;
                console.log('HEEEEEEY ' + Remaining);
              };
              document.getElementById("Left2").style.display = "inline-block";
              document.getElementById("Left").innerHTML = "<br>Job: " + Job + "<br>Salary: <span class='IncomeColour'>£" + numberComma(
                  Salary) + '</span><br>' +
                "Salary After Tax: <span class='IncomeColour'>£" + numberComma(WageAfterTax) + "</span><br>Rent: <span class='ExpenseColour'>£" + numberComma(Rent) + "</span><br>Expenses: <span class='ExpenseColour'>£" + numberComma(Expenses) +
                "</span><br>Remaining: £" + numberComma(Remaining) + "<br>Savings: £" + numberComma(Savings) + "<br>Pension Pot: £" + numberComma(PensionPot);
            } else if (RetirementTrue == true) {
              doughnut = doughnut + 1;
              Salary = PensionPerYear;
              Salary = Math.round(Salary)
              WageAfterTax = PensionPerYearAfterTax;
              WageAfterTax = Math.round(WageAfterTax);

              //Check if spouse retired or not.
              if (SpouseRetirementTrue == true) {
                SpouseWageAfterTax = SpousePensionPerYearAfterTax;
                if (doughnut != FinalAgeDeath) {
                  SpousePensionPot = SpousePensionPot - (SpousePensionPot / (FinalAgeDeath - doughnut));
                }
              } else if (SpouseRetirementTrue == false && Married == true) {
                CheckSpouseSalary();
                SpouseTaxCalculator();
                SpousePensionFunds();
              }

              if (Married == true) {
                var HouseholdIncome = WageAfterTax + SpouseWageAfterTax;
              } else if (Married == false) {
                var HouseholdIncome = WageAfterTax
              }

              FinalAgeDeath = parseInt(FinalAgeDeath);
              if (doughnut != FinalAgeDeath) {
                PensionPot = PensionPot - (PensionPot / (FinalAgeDeath - doughnut));
              }
              PensionPot = Math.round(PensionPot);
              HousingCost();
              CheckFamilySize();
              Remaining = HouseholdIncome - Rent - Expenses
              Savings = Savings + Remaining;

              document.getElementById("Left").innerHTML = "Job: Retired" + "<br>Pension Salary: <span class='IncomeColour'>£" +
                numberComma(
                  Salary) + '</span><br>' +
                "Pension After Tax: <span class='IncomeColour'>£" + numberComma(WageAfterTax) + "</span><br>Rent: <span class='ExpenseColour'>£" + numberComma(Rent) + "</span><br>Expenses: <span class='ExpenseColour'>£" + numberComma(Expenses) +
                "</span><br>Remaining: £" + numberComma(WageAfterTax - Rent - Expenses) + "<br>Savings: £" + numberComma(
                  Savings) + "<br>Pension Pot: £" + numberComma(PensionPot);

            } else if (doughnut < 18 && WentToUniversity == false) {
              doughnut = doughnut + 1;
            }
          }
        }, 800);
    };

    function myFunction() {
      document.getElementById("CurrentAge").innerHTML = add();
    };

    //Looks at data to see if 5+ GCSEs were obtained.
    var KS4 = function() {
      document.getElementById('TheContinueButton').style.display = "none";
      document.getElementById('EducationChartTitle').style.display = "none";
      document.getElementById('BeforeGCSEResults').style.display = "block";
      document.getElementById('LifeEvent').style.display = "block";
      PopOut();
      d3.csv("LevelTwo.csv", function(LevelTwoData) {
        var filteredData = LevelTwoData.filter(function(d) {
          if (d['LA'] === LA) {
            return d;
          };
        });
        var chance = Math.floor((Math.random() * 100) + 1);
        LevelTwoChance = filteredData[0]['LevelTwo'];
        if (LevelTwoChance >= chance) {
          //document.getElementById("Education").innerHTML = "You did well in your GCSEs. In your area " + LevelTwoChance + "% got 5 GCSEs between A* and C.";
          EducationLevel = EducationLevel + 1;
          console.log('Education Level: ' + EducationLevel);
          GCSEPass = true;
        } else {
          //document.getElementById("Education").innerHTML = "You didn't do so well in your GCSEs. In your area " + LevelTwoChance + "% got 5 GCSEs between A* and C.";
          GCSEPass = false;
        };

        //KS4Destination();
      });
    };

    //Looks at data to see where they will go after GCSEs
    var KS4Destination = function() {

      d3.csv("KS4Destination.csv", function(KS4DestinationData) {
        var filteredData = KS4DestinationData.filter(function(d) {
          if (d['LA'] === LA) {
            return d;
          };
        });

        var chance = Math.floor((Math.random() * 100) + 1);

        var FurtherEducation = filteredData[0]['FurtherEducation'];
        var EmploymentOrTraining = filteredData[0]['EmploymentOrTraining'];
        var NotInEducationOrWork = filteredData[0]['NotInEducationOrWork'];

        var FurtherEducation = parseInt(FurtherEducation);
        var EmploymentOrTraining = parseInt(EmploymentOrTraining);
        var NotInEducationOrWork = parseInt(NotInEducationOrWork);

        var margin = {
          top: 60,
          right: 70,
          bottom: 40,
          left: 70
        }


        var width = parseInt(d3.select("#ChartAreaDiv").style("width")) - margin.left - margin.right;
        EducationWidth = parseInt(d3.select("#ChartAreaDiv").style("width")) - margin.left - margin.right;
        var height = 145 - margin.top - margin.bottom;
        var data = [{
          "Percentage": (FurtherEducation + EmploymentOrTraining + NotInEducationOrWork),
          "Name": "FurtherEducation"
        }, {
          "Percentage": (EmploymentOrTraining + NotInEducationOrWork),
          "Name": "EmploymentOrTraining"
        }, {
          "Percentage": NotInEducationOrWork,
          "Name": "NotInEducationOrWork"
        }]; // here are the data values; v1 = total, v2 = current value
        var data1 = [FurtherEducation, EmploymentOrTraining, NotInEducationOrWork];
        var chart = d3.select("#ChartAreaDiv").append("svg") // creating the svg object inside the container div
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")")
          .attr("margin", margin);

        var x = d3.scaleLinear() // takes the fixed width and creates the percentage from the data values
          .domain([0, d3.max(data, function(d) {
            return d.Percentage;
          })])
          .range([0, width]);

        var x1 = d3.scaleLinear() // takes the fixed width and creates the percentage from the data values
          .domain([0, d3.max(data1, function(d) {
            return d.Percentage;
          })])
          .range([0, width]);

        var a = ['#9CDAB3', '#F5AD9D', '#82AEDF'];

        var defs = chart.append("defs")
        var pattern = chart.append("pattern")
          .data(data)
          .enter()
          .selectAll("pattern")
          .attr('id', "hash4_4")
          .attr('width', "7")
          .attr('height', "7")
          .attr('patternUnits', "userSpaceOnUse")
          .attr('patternTransform', "rotate(45)")
          .append("rect")
          .attr('width', "4")
          .attr('height', "8")
          .attr('transform', "translate(0,0)")
          .attr('fill', "white")
          .style('opacity', 1)

        chart.selectAll("myrect") // this is what actually creates the bars
          .data(data)
          .enter().append("rect")
          .attr('class', 'myrect')
          .attr("width", function(d) { // sets the x position of the bar
            return x(d.Percentage);
          })
          .attr("fill", function(d, i) {
            return a[i]
          })
          .attr("height", 30)
          .attr("rx", 6) // rounded corners
          .attr("ry", 6);

        chart.selectAll("myrect")
          .data(data)
          .enter()
          .append("rect")
          .attr('class', 'myrect')
          .attr("width", function(d) {
            return x(d.Percentage);
          })
          .attr("height", 30)
          .attr("rx", 6)
          .attr("ry", 6)
          .attr('fill', "url(#hash4_4)")
          .attr('id', function(d, i) {
            return d['Name']
          })

        chart.selectAll("text") // adding the text labels to the bar
          .data(data)
          .enter().append("text")
          .attr("x", function(d) { // sets the x position of the bar
            return x(d.Percentage);
          })
          .attr("y", 15) // y position of the text inside bar
          .attr("dx", -10) // padding-right
          .attr("dy", ".42em") // vertical-align: middle
          .attr("text-anchor", "middle") // text-align: right
          .style("font-weight", "bold")
          .style("font-size", "1.25em")
          .data(data1)
          .text(String);

        chart.append("line")
          .attr("x1", 0)
          .attr("y1", 15)
          .attr("x2", -15)
          .attr("y2", 15)
          .attr("stroke-width", 2)
          .attr("stroke", "grey");

        chart.append("foreignObject")
          .attr("x", -70)
          .attr("y", -10)
          .attr("width", 45)
          .attr("height", 100)
          .append("xhtml:ChartAreaDiv")
          .style("font-weight", "bold")
          .style("font-size", "0.74em")
          .style("color", "grey")
          .html("Not in education or work");


        chart.append("line")
          .attr("x1", width)
          .attr("y1", 15)
          .attr("x2", width + 15)
          .attr("y2", 15)
          .attr("stroke-width", 2)
          .attr("stroke", "grey");

        chart.append("foreignObject")
          .attr("x", width + 17)
          .attr("y", -10)
          .attr("width", 45)
          .attr("height", 100)
          .append("xhtml:ChartAreaDiv")
          .style("font-weight", "bold")
          .style("font-size", "0.74em")
          .style("color", "grey")
          .html("In education");


        //THIS ONE NEEDS TO BE MADE SO ITS X CHANGES TO CENTER OF BAR
        chart.append("line")
          .attr("x1", 40)
          .attr("y1", 30)
          .attr("x2", 40)
          .attr("y2", 45)
          .attr("stroke-width", 2)
          .attr("stroke", "grey");

        chart.append("foreignObject")
          .attr("x", 20)
          .attr("y", 50)
          .attr("width", 150)
          .attr("height", 100)
          .append("xhtml:ChartAreaDiv")
          .style("font-weight", "bold")
          .style("font-size", "0.74em")
          .style("color", "grey")
          .html("Employment or training");


        document.getElementById('BeforeGCSEResults').style.display = "none";
        document.getElementById('TheContinueButton').style.display = "block";
        document.getElementById('EducationChartTitle').style.display = "block";
        if ((EmploymentOrTraining >= chance) && (GCSEPass == false)) {
          document.getElementById("PopOutContent").innerHTML = "You didn't get 5 GCSEs between A* and C. In your area " + LevelTwoChance + "% did get 5 GCSEs between A* and C.<br><br>" +
            "You go into vocational training / employment after completeing your GCSEs. ";
          LifeEvent();
          doughnut = doughnut + 1;
        } else if ((NotInEducationOrWork >= chance) && (GCSEPass == false)) {
          document.getElementById("PopOutContent").innerHTML = "You didn't get 5 GCSEs between A* and C. In your area " + LevelTwoChance + "% did get 5 GCSEs between A* and C.<br><br>" +
            "You are not in education or work 6 months after finishing your GCSEs.";
          LifeEvent();
          doughnut = doughnut + 1;
        } else if (GCSEPass == true) {
          document.getElementById("PopOutContent").innerHTML = "You got 5 GCSEs between A* and C GCSEs. In your area " + LevelTwoChance + "% of students got the same.<br><br>" + "You decide to carry on in education.";
          LifeEvent();
          doughnut = doughnut + 1;
        } else {
          document.getElementById("PopOutContent").innerHTML = "You didn't get 5 GCSEs between A* and C. In your area " + LevelTwoChance + "% did get 5 GCSEs between A* and C.<br><br>" + "You decide to carry on in education.";
          LifeEvent();
          doughnut = doughnut + 1;
        };
      });
    };

    var StartUniversity = function() {
      Job = 'Student';
      LifeChoice();
      document.getElementById("TheContinueButton").style.display = "block";
      document.getElementById("Left").innerHTML = "<b>You</b><br>Age: " + doughnut + "<br>Gender: " + Gender + "<br>Born in: " + AdminDistrictWard + ', ' + AdminDistrictName + "<br>Job: " + Job + "<br>Salary: £" + numberComma(Salary) + '<br>';
      if (document.getElementById('ApplyUni').value == 'Yes') {

        document.getElementById("UniversityChoice").style.display = "none";
        document.getElementById("TheContinueButton").style.display = "block";

        GoUniversity();
      } else if (document.getElementById('ApplyUni').value == 'No') {
        document.getElementById("UniversityChoice").style.display = "none";
        document.getElementById("TheContinueButton").style.display = "block";

        d3.csv("UniDestination.csv", function(UniDestinationData) {
          var filteredData = UniDestinationData.filter(function(d) {
            if (d['LA'] === LA) {
              return d;
            };
          });

          Oxbridge = filteredData[0]['Oxbridge'];
          TopThirdHEI = filteredData[0]['TopThirdHEI'];
          OtherHE = filteredData[0]['OtherHE'];
        });
        Work();

      } else {
        alert('Choose whether or not to apply to university.');
      };
    };

    var Work = function() {
      document.getElementById("UniversityChoice").innerHTML = "";
      var select = document.getElementById("WorkDropDown");
      console.log('Work');
      //Make work choice visable.
      //Check which age range to look for in the csv
      var JobCSV = '';
      if (Gender === "Male") {
        JobCSV = "JobChance5.csv";
      } else if (Gender === "Female") {
        JobCSV = "JobChanceFemale3.csv";
      }
      d3.csv(JobCSV, function(JobChanceData) {
        var AgeRangeTest = '';
        if (doughnut <= 21) {
          AgeRangeTest = '18-21';
        } else if (doughnut <= 29) {
          AgeRangeTest = '22-29';
        } else if (doughnut <= 39) {
          AgeRangeTest = '30-39'
        } else if (doughnut <= 49) {
          AgeRangeTest = '40-49'
        } else if (doughnut <= 59) {
          AgeRangeTest = '50-59'
        } else if (doughnut <= 60) {
          AgeRangeTest = '60'
        }


        var lessThan1 = JobChanceData.filter(function(d) {
          return d.AgeRange === AgeRangeTest
        });
        lessThan1.forEach(function(index) {
          var chance = 0
          if (EducationLevel == 0) {
            var chance = Math.floor((Math.random() * 10) + 1);
            if ((chance <= index['Percentage']) && (EducationLevel >= index['EducationLevel'])) {
              console.log(index);
              select.options[select.options.length] = new Option(index['Occupation'], index['MedianAnnualWage']);
              document.getElementById('Information').innerHTML =
                "<p style='color:red' class='RedSize'><b>CAN'T</b><br></p><p><b>List of jobs you cannot apply to:</b><br><br>1. Managers, Directors and Senior Officials<br>2. Associate professional and technical<br>3. Professional Jobs<br>4. Adminstrative and secretarial<br>5. Caring, leisure and other services<br><br><b>Reason:</b><br>You did not get the education required for most of these jobs.";
              InformationDisplay = true;
              noOptions();
            }

          } else if (EducationLevel == 1) {
            var chance = Math.floor((Math.random() * 1) + 1);
            if ((chance <= index['Percentage']) && (EducationLevel >= index['EducationLevel'])) {
              console.log(index);
              select.options[select.options.length] = new Option(index['Occupation'], index['MedianAnnualWage']);
              document.getElementById('Information').innerHTML =
                "<p style='color:red' class='RedSize'><b>CAN'T</b><br></p><p><b>List of jobs you cannot apply to:</b><br><br>1. Managers, Directors and Senior Officials<br>2. Associate professional and technical<br>3. Professional Jobs<br><br><b>Reason:</b><br>You did not get the skill level required for most of these jobs.</p>";
              InformationDisplay = true;
              noOptions();
            }

          } else if (EducationLevel == 2) {
            var chance = Math.floor((Math.random() * 5) + 1);
            if ((chance <= index['Percentage']) && (EducationLevel >= index['EducationLevel'])) {
              console.log(index);
              select.options[select.options.length] = new Option(index['Occupation'], index['MedianAnnualWage']);
              noOptions();
            }

          } else if (EducationLevel == 3) {
            var chance = Math.floor((Math.random() * 2) + 1);
            if ((chance <= index['Percentage']) && (EducationLevel >= index['EducationLevel'])) {
              console.log(index);
              select.options[select.options.length] = new Option(index['Occupation'], index['MedianAnnualWage']);
              noOptions();
            }

          } else if (EducationLevel == 4) {
            var chance = 1;
            if ((chance <= index['Percentage']) && (EducationLevel >= index['EducationLevel'])) {
              console.log(index);
              select.options[select.options.length] = new Option(index['Occupation'], index['MedianAnnualWage']);
              noOptions();
            }

          };

          //Makes sure there is always an option.

        });

      });
    };
    var noOptions = function() {
      var lengthDropDown = document.getElementById("WorkDropDown").options.length;
      document.getElementById("PopOutContent").innerHTML = "";
      document.getElementById("LifeChoice").style.display = "none";
      document.getElementById("LifeEvent").style.display = "none";
      document.getElementById("TheContinueButton").style.display = "none";
      document.getElementById("WorkChoice").style.display = "block";
      LifeChoice();
      if (lengthDropDown < 1) {
        Work();
        console.log('No options worked');
      };
    }
    var GoUniversity = function() {
      console.log('StartUniversity');
      d3.csv("UniDestination.csv", function(UniDestinationData) {
        var filteredData = UniDestinationData.filter(function(d) {
          if (d['LA'] === LA) {
            return d;
          };
        });
        var chance = Math.floor((Math.random() * 100) + 1);

        Oxbridge = filteredData[0]['Oxbridge'];
        TopThirdHEI = filteredData[0]['TopThirdHEI'];
        OtherHE = filteredData[0]['OtherHE'];
        var WalesUniExplainer = '';
        if (Country == 'Wales'){
          WalesUniExplainer = '<br><br>NOTE: Figures for Welsh University are only intended for use in the game as they are basic estimates based on how many people in the areas go to university. This is because the data of where they go to university is not published in Wales as it is in England.'
        }
        //Education3 changed to PopOutContent
        if (Oxbridge >= chance) {
          document.getElementById("PopOutContent").innerHTML = "You get into Oxbridge!" + "In your area " + Oxbridge + "% of KS5 leavers got into university in Oxford or Cambridge, while " +
            TopThirdHEI + "% went to a university in the top third of university rankings. There were " + OtherHE + "% who went to other higher education institutes." + WalesUniExplainer;
          UniPoints = 3;
          PopOutWait2 = true;
        } else if (TopThirdHEI >= chance) {
          document.getElementById("PopOutContent").innerHTML = "You get into a university ranked in the top third! " + "In your area " + Oxbridge + "% of KS5 leavers got into university in Oxford or Cambridge, while " +
            TopThirdHEI + "% went to a university in the top third of university rankings. There were " + OtherHE + "% who went to other higher education institutes." + WalesUniExplainer;
          UniPoints = 2;
          PopOutWait2 = true;
        } else if (OtherHE >= chance) {
          document.getElementById("PopOutContent").innerHTML = "You get into university! It isn't one ranked in the top third, but atleast you got in. " + "In your area " + Oxbridge +
            "% of KS5 leavers got into university in Oxford or Cambridge, while " +
            TopThirdHEI + "% went to a university in the top third of university rankings. There were " + OtherHE + "% who went to other higher education institutes." + WalesUniExplainer;
          UniPoints = 1;
          PopOutWait2 = true;
        } else {
          document.getElementById("PopOutContent").innerHTML = "You didn't get into university, it is time to start work.";
          document.getElementById("TheContinueButton").style.display = "block";
          PopOutWait = true;

          //Work();
        };
        LifeEvent();
      });
    };

    var PassUni = function() {
      var chance = Math.floor((Math.random() * 100) + 1);
      WentToUniversity = true;
      doughnut = doughnut + 4;
      if (81 <= chance) {
        document.getElementById("PopOutContent").innerHTML = "You didn't finish university, it is time to start work.";
        document.getElementById("TheContinueButton").style.display = "block";
        LifeEvent();
        Work();
      } else {
        document.getElementById("PopOutContent").innerHTML = "Congratulations - you finished university!";
        document.getElementById("TheContinueButton").style.display = "block";
        document.getElementById("UniLogo").style.visibility = 'visible';
        LifeEvent();
        EducationLevel = EducationLevel + UniPoints;
        console.log('Education Level: ' + EducationLevel);
        Work();
      }
    };

    var StartWork = function() {
      document.getElementById("Information").style.display = "none";
      document.getElementById("WorkChoice").style.display = "none";
      document.getElementById("UniversityChoice").style.display = "none";
      var index = document.getElementById('WorkDropDown').selectedIndex;
      console.log(index);
      Job = document.getElementById('WorkDropDown')[index].textContent;
      Salary = document.getElementById('WorkDropDown').value;
      console.log(AdminDistrict)
      d3.csv("PriceDifference.csv", function(PriceDifferenceData) {
        var filteredData = PriceDifferenceData.filter(function(d) {
          if (d['Code'] === AdminDistrict) {
            return d;

          };
        });
        console.log(filteredData);
        var Difference1 = (parseInt(filteredData[0]['Difference']) * parseInt(Salary)) / 100;
        WageDifference = Math.round(filteredData[0]['Difference']);
        console.log(Difference1);
        Salary = parseInt(Salary) + ((parseInt(filteredData[0]['Difference']) * parseInt(Salary)) / 100);
        Salary = Math.round(Salary);

        //WorkWage to PopOut
        if (Math.round(filteredData[0]['Difference']) > 0) {
          document.getElementById("TheContinueButton").style.display = "block";
          document.getElementById("WorkLogo").style.visibility = 'visible';
          document.getElementById("PopOutContent").innerHTML = "Your salary is £" + numberComma(Salary) + " a year, and will increase each year based on the average salary for your age and job. <br>There is a +" + Math.round(filteredData[0]['Difference']) + "% difference in wage between " + LA + " and average for England and Wales.";
          LifeEvent();
        } else {
          document.getElementById("TheContinueButton").style.display = "block";
          document.getElementById("WorkLogo").style.visibility = 'visible';
          document.getElementById("PopOutContent").innerHTML = "Your salary is £" + numberComma(Salary) + " a year, and will increase each year based on the average salary for your age and job. <br>There is a " + Math.round(filteredData[0][
            'Difference'
          ]) + "% difference in wage between " + LA + " and average for England and Wales.";
          LifeEvent();
        }
      });

      console.log(Salary);
      console.log(Job);
      doughnut = doughnut + 1;
    }

    //Function to change salary to avg for ageband.
    var CheckSalary = function() {
      var JobCSV = '';
      if (Gender === "Male") {
        JobCSV = "JobChance5.csv";
      } else if (Gender === "Female") {
        JobCSV = "JobChanceFemale3.csv";
      }

      d3.csv(JobCSV, function(JobChanceData) {
        var AgeRangeTest = '';
        var AgeRangeTest10 = '';
        if (doughnut <= 21) {
          AgeRangeTest = '18-21';
          AgeRangeTest10 = '22-29';
        } else if (doughnut <= 29) {
          AgeRangeTest = '22-29';
          AgeRangeTest10 = '30-39';
        } else if (doughnut <= 39) {
          AgeRangeTest = '30-39';
          AgeRangeTest10 = '40-49';
        } else if (doughnut <= 49) {
          AgeRangeTest = '40-49';
          AgeRangeTest10 = '50-59';
        } else if (doughnut <= 59) {
          AgeRangeTest = '50-59';
          AgeRangeTest10 = '60';
        } else if (doughnut <= 60) {
          AgeRangeTest = '60';
          AgeRangeTest10 = '60';
        }

        var lessThan1 = JobChanceData.filter(function(d) {
          return (d.Occupation == Job)
        });

        lessThan1.forEach(function(index) {
          if (index['AgeRange'] == AgeRangeTest10) {
            Salary10 = index['MedianAnnualWage'];
            Salary10 = parseInt(Salary10);
            console.log(Salary10 + ' SALARY10');
          }
        })

        lessThan1.forEach(function(index) {
          if (index['AgeRange'] == AgeRangeTest) {
            if (doughnut <= 21) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              Salary = Salary + SalaryDifference;
              if (doughnut == 21) {
                Salary = SalaryActual;
              }
            } else if (doughnut <= 29) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              Salary = Salary + SalaryDifference;
              if (doughnut == 29) {
                Salary = SalaryActual;
              }
            } else if (doughnut <= 39) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              Salary = Salary + SalaryDifference;
              if (doughnut == 39) {
                Salary = SalaryActual;
              }
            } else if (doughnut <= 49) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              Salary = Salary + SalaryDifference;
              if (doughnut == 49) {
                Salary = SalaryActual;
              }
            } else if (doughnut <= 59) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              Salary = Salary + SalaryDifference;
              if (doughnut == 59) {
                Salary = SalaryActual;
              }
            } else if (doughnut <= 60) {
              var SalaryActual = index['MedianAnnualWage'];
              Salary = SalaryActual;
              if (68 <= doughnut) {
                Salary = Salary + 8296;
              }
            }
            console.log(Salary + ' SALARY');
          };
        });
      });
    };

    var HousingCost = function() {
      var select = document.getElementById("RentDropDown");
      if (Blocker4 == 0) {
        d3.csv("Rent2.csv", function(RentCostData) {
          rentFilter = RentCostData.filter(function(d) {
            return (d.LAD === AdminDistrict);
            console.log(d.LAD);
            console.log(AdminDistrict);
          })
          RentCostData1 = RentCostData;
          //Rent = rentFilter[0]['1Bedroom'];
          RentParents = 0;
          Rent0 = rentFilter[0]['1RoomSharedHouse'];
          Rent1 = rentFilter[0]['1Bedroom'];
          Rent2 = rentFilter[0]['2Bedroom'];
          Rent3 = rentFilter[0]['3Bedroom'];
          Rent4 = rentFilter[0]['4Bedroom'];
          console.log(Rent0);
          VisitEstateAgents();
          //document.getElementById("EstateAgents").style.display = "block";
          select.options[select.options.length] = new Option('Living with parents: £' + 0, 0);
          if (Rent0 > 0) {
            select.options[select.options.length] = new Option('Rent Bedroom Shared House: £' + Rent0, Rent0);
            IsRent0Option = true;
          }
          select.options[select.options.length] = new Option('Rent 1 Bedroom: £' + Rent1, Rent1);
          select.options[select.options.length] = new Option('Rent 2 Bedroom: £' + Rent2, Rent2);
          select.options[select.options.length] = new Option('Rent 3 Bedroom: £' + Rent3, Rent3);
          select.options[select.options.length] = new Option('Rent 4 Bedroom: £' + Rent4, Rent4);
        });
        Blocker4 = 1;
      }
      Rent = document.getElementById("RentDropDown").value;
      Rent = parseInt(Rent);
      var HouseholdIncome2 = WageAfterTax + SpouseWageAfterTax;
      for (i = 0; i < select.length; i++) {
        if (select.options[i].value > (HouseholdIncome2 - Expenses)) {
          select.options[i].style.color = "#ff6961";
        }
        else {
          select.options[i].style.color = "#66cc66";
        };
      };
      /*
      if (IsRent0Option == false) {
        if (howManyDependantChildren == 0) {
          //Delete 1 bed option
          for (i = 0; i < select.length; ++i) {
            if (select.length == 4) {
              select.options[select.options.length] = new Option('Rent 1 Bedroom: £' + Rent1, Rent1);
            }
          };
        };
        if (howManyDependantChildren > 0) {
          //Delete 1 bed option
          for (i = 0; i < select.length; i++) {
            if (select.options[i].value == Rent1) {
              select.remove(i);
            };
          };
          for (i = 0; i < select.length; ++i) {
            if (select.length == 3) {
              select.options[select.options.length] = new Option('Rent 2 Bedroom: £' + Rent2, Rent2);
            }
          };
        };
        if (howManyDependantChildren > 2) {
          //Delete 2 bed option
          for (i = 0; i < select.length; i++) {
            if (select.options[i].value == Rent2) {
              select.remove(i);
            };
          };
        };
      } else if (IsRent0Option == true) {
        if (howManyDependantChildren == 0) {
          //Delete 1 bed option
          for (i = 0; i < select.length; ++i) {
            if (select.length == 4) {
              select.options[select.options.length] = new Option('Rent 1 Bedroom: £' + Rent1, Rent1);
              select.options[select.options.length] = new Option('Rent Bedroom Shared House: £' + Rent0, Rent0);
            }
          };
        };
        if (howManyDependantChildren > 0) {
          //Delete 1 bed option
          for (i = 0; i < select.length; i++) {
            if (select.options[i].value == Rent1) {
              select.remove(i);
            };
            if (select.options[i].value == Rent0) {
              select.remove(i);
            };
          };
          for (i = 0; i < select.length; ++i) {
            if (select.length == 3) {
              select.options[select.options.length] = new Option('Rent 2 Bedroom: £' + Rent2, Rent2);
            }
          };
        };
        if (howManyDependantChildren > 2) {
          //Delete 2 bed option
          for (i = 0; i < select.length; i++) {
            if (select.options[i].value == Rent2) {
              select.remove(i);
            };
          };
        };

      }

      */
      d3.csv("CouncilTaxEnglandAndWales1.csv", function(CouncilTaxData) {
        var councilTaxFilter = CouncilTaxData.filter(function(d) {
          return (d.LocalAuthorityCode === AdminDistrict);
        })
        console.log(councilTaxFilter);
        console.log(CouncilTaxData);
        var BandA = councilTaxFilter[0]['A '];
        var BandB = councilTaxFilter[0]['B '];
        var BandC = councilTaxFilter[0]['C '];
        var BandD = councilTaxFilter[0]['D '];
        var BandE = councilTaxFilter[0]['E '];
        var BandF = councilTaxFilter[0]['F '];
        var BandG = councilTaxFilter[0]['G '];
        var BandH = councilTaxFilter[0]['H '];

        if (Rent = Rent0) {
          CouncilTax = BandC / 3;
        }
        if (Rent = Rent1) {
          CouncilTax = BandA;
        }
        if (Rent = Rent2) {
          CouncilTax = BandB;
        }
        if (Rent = Rent3) {
          CouncilTax = BandC;
        }
        if (Rent = Rent4) {
          CouncilTax = BandE;
        }

      });
    };

    var CheckFamilySize = function() {

      console.log('CHILDAGE: ' + (doughnut - Child1Doughnut));
      if ((Child1Doughnut != 0) && ((doughnut - Child1Doughnut) > 21) && (Child1Dependant == false)) {
        howManyDependantChildren = howManyDependantChildren - 1;
        Child1Dependant = true;
        console.log(Child1Name + ' moved out of home.');

      };
      if ((Child2Doughnut != 0) && ((doughnut - Child2Doughnut) > 21) && (Child2Dependant == false)) {
        howManyDependantChildren = howManyDependantChildren - 1;
        Child2Dependant = true;
        console.log(Child2Name + ' moved out of home.');
      };
      if ((Child3Doughnut != 0) && ((doughnut - Child3Doughnut) > 21) && (Child3Dependant == false)) {
        howManyDependantChildren = howManyDependantChildren - 1;
        Child3Dependant = true;
        console.log(Child3Name + ' moved out of home.');
      };
      console.log('Children: ' + howManyChildren + ' DependantChildren: ' + howManyDependantChildren);
      if (Married == false) {
        if (howManyDependantChildren == 0) {
          FamilySize = '1Adult';
        } else if (howManyDependantChildren == 1) {
          FamilySize = '1Adult1Child';
        } else if (howManyDependantChildren == 2) {
          FamilySize = '1Adult2Child';
        } else if (howManyDependantChildren == 3) {
          FamilySize = '1Adult3Child';
        };

      } else if (Married == true && howManyDependantChildren == 0) {
        FamilySize = '2Adult';
      } else if (Married == true && howManyDependantChildren == 1) {
        FamilySize = '2Adult1Child';
      } else if (Married == true && howManyDependantChildren == 2) {
        FamilySize = '2Adult2Child';
      } else if (Married == true && howManyDependantChildren == 3) {
        FamilySize = '2Adult3Child';
      };
      CheckExpenditure();
    }

    var CheckExpenditure = function() {

      console.log('Family Size: ' + FamilySize)
      //Find which economic quintile band in based on wage and familysize
      d3.csv("Wages1.csv", function(SalaryData) {
        var salaryFilter = SalaryData.filter(function(d) {
          return (d.FamilySize == FamilySize)
        })
        var householdWage = Salary + SpouseWage;
        if (parseInt(salaryFilter[0]['5']) <= householdWage) {
          QuintileBand = 5;
        } else if (parseInt(salaryFilter[0]['4']) <= householdWage) {
          QuintileBand = 4;
        } else if (parseInt(salaryFilter[0]['3']) <= householdWage) {
          QuintileBand = 3;
        } else if (parseInt(salaryFilter[0]['2']) <= householdWage) {
          QuintileBand = 2;
        } else {
          QuintileBand = 1;
        }
        console.log('Quintile Band: ' + QuintileBand);
        console.log(salaryFilter);
      })
      /*
      d3.csv("IncomePercentage.csv", function(IncomePercentageData) {
        var IncomePercentageFilter = IncomePercentageData.filter(function(d) {
          return (d.EconomicQuintile == QuintileBand)
        })
        var Percentage = parseInt(IncomePercentageFilter[0]['Percentage']);
        Salary = parseInt(Salary);
        console.log(Percentage);
        console.log(Salary);
        Income = Salary / (Percentage / 100);
        console.log('Income: ' + parseInt(Income));
      })
      */
      Salary = parseInt(Salary);
      d3.csv("Expenses.csv", function(ExpensesData) {
        var ExpensesFilter = ExpensesData.filter(function(d) {
          return (d.FamilySize == FamilySize)
        })
        Expenses = parseInt(ExpensesFilter[0][QuintileBand]);
        console.log('Expenses: ' + Expenses);
      })

      d3.csv("regionalDifferenceCostLiving.csv", function(RegionalDifferenceData) {
        var RegionalDifferenceFilter = RegionalDifferenceData.filter(function(d) {
          return (d.Region == Region)
        })
        console.log(RegionalDifferenceFilter);
        console.log(Region);
        var RegionalDifference = RegionalDifferenceFilter[0]['Difference'];
        console.log('Expenses before: £' + Expenses);
        Expenses = Expenses + (Expenses * RegionalDifference);
        console.log('Expenses after: £' + Expenses);
        Expenses = Math.round(Expenses);
      })
    };

    //Calculate NI, income tax and student loan tax.
    var TaxCalculator = function() {
      var IncomeTaxableWage = parseInt(Salary) - 11000;

      var IncomeTax = 0;
      var NationalInsurance = 0;
      var StudentLoan = 0;
      if (IncomeTaxableWage < 32001) {
        IncomeTax = IncomeTaxableWage * 0.2;
      } else if (IncomeTaxableWage < 150000) {
        IncomeTax = (32000 * 0.2) + ((IncomeTaxableWage - 32000) * 0.4)
      }

      if (Salary > 8163 && Salary < 45001) {
        NationalInsurance = (Salary - 8163) * 0.12;
      } else if (Salary > 45000) {
        var NITaxableSalary = Salary - 8163;
        NationalInsurance = (36837 * 0.12) + ((NITaxableSalary - 36837) * 0.2)
      }

      if (StudentLoanTotal > 0 && doughnut < 51 && WentToUniversity == true) {
        Salary = parseInt(Salary);
        if (WentToUniversity == true && Salary > 21000) {
          StudentLoan = (Salary - 21000) * 0.09;
          StudentLoanTotal = (StudentLoanTotal * 1.046) - StudentLoan;
          //console.log('Student Loan Remaining: £' + Math.round(StudentLoanTotal));
        } else if (WentToUniversity == true && Salary < 21000) {
          StudentLoanTotal = (StudentLoanTotal * 1.046)
          //console.log('Student Loan Remaining: £' + Math.round(StudentLoanTotal));
        }
      } else if (StudentLoanTotal < 0 && WentToUniversity == true && StudentLoanFinished == false) {
        StudentLoan = 0;
        console.log('Paid off student loan.');
        document.getElementById("PopOutContent").innerHTML = "You paid off your student loan!"
        StudentLoanFinished = true;
        LifeEvent();

      } else if (doughnut > 51 && WentToUniversity == true && StudentLoanFinished == false) {
        StudentLoan = 0;
        StudentLoanFinished = true;
        console.log('After 30 years your student loan was wiped out, with £' + numberComma(Math.round(StudentLoanTotal)) + ' left unpaid.');
        document.getElementById("PopOutContent").innerHTML = 'After 30 years your student loan was wiped out, with £' + numberComma(Math.round(StudentLoanTotal)) + ' left unpaid.'
        LifeEvent();
      }
      WageAfterTax = Salary - NationalInsurance - IncomeTax - StudentLoan - YearlyPensionContribution;
      WageAfterTax = Math.round(WageAfterTax);
      console.log('Wage after tax: ' + WageAfterTax);
    };

    var PensionFunds = function() {
      //Okay we need to find the max percentage that they can spend. Lets go.
      if (Remaining > 0) {
        //Find the max percentage someone can pay on pension.
        maxPercentagePension = (Remaining / Salary) * 100;
        maxPercentagePension = Math.floor(maxPercentagePension);

        //Set max value and show pension input form
        var input = document.getElementById("PercentagePensionInput");
        input.setAttribute("max", maxPercentagePension);
        document.getElementById("PercentagePensionInputForm").style.visibility = "visible";

        //Find out how much pension is taken.
        YearlyPensionContribution = Salary * ((document.getElementById('PercentagePensionInput').value) / 100)
        console.log('Yearly Pension Contribution:' + YearlyPensionContribution);
        PensionPot = PensionPot + (YearlyPensionContribution * 2);
        PensionPot = Math.round(PensionPot);
      } else if (Remaining < 0) {
        document.getElementById('PercentagePensionInput').value = 3;
      }

      var ExpRent = parseInt(Expenses) + parseInt(Rent);
      YearsLeft = parseInt(FinalAgeDeath) - doughnut;
      var MoneyNeededToRetire = ExpRent + YearsLeft;
      var TotalGovernmentPension = (parseInt(FinalAgeDeath) - 68) * 8296;
      var PensionPotAndGov = TotalGovernmentPension + PensionPot;
      PensionPerYear = PensionPotAndGov / YearsLeft;
      PensionPerYearAfterTax = 0

      var PensionPerYearTaxable = PensionPerYear - 11000;
      var PensionPerYearTaxable25 = PensionPerYearTaxable * 0.25
      if (PensionPerYearTaxable < 32001) {
        PensionPerYearAfterTax = PensionPerYearTaxable25 + 11000 + PensionPerYearTaxable - (PensionPerYearTaxable * 0.2);
      } else if (PensionPerYearTaxable < 150000) {
        PensionPerYearAfterTax = PensionPerYearTaxable25 + 11000 + PensionPerYearTaxable - ((32000 * 0.2) + ((PensionPerYearTaxable - 32000) * 0.4));
      }
      PensionPerYearAfterTax = Math.round(PensionPerYearAfterTax);
      console.log(ExpRent);

      if (PensionPerYearAfterTax >= (WageAfterTax * 0.75) && doughnut > 55 && blocker2 != 1) {
        //RetireButton to PopOutContent
        document.getElementById("PopOutContent").innerHTML = 'You have saved £' + numberComma(PensionPot) + ' in your pension pot and recieve £8,296 a year from the government at age 68.<br>After tax, you retire on £' + numberComma(
          PensionPerYearAfterTax) + ' a year at age ' + doughnut + '.';
        blocker2 = 1;
        RetirementTrue = true;
        LifeEvent();
        document.getElementById("PercentagePensionInputForm").style.display = "none";

      };

    };

    // Decides the age the marriage pop up should appear.
    var AgeMarriage = function() {
      var MarriageChance = Math.floor(Math.random() * 1000) + 1;
      console.log('MarriageChance ' + MarriageChance);
      d3.csv("AgeOfMarriage.csv", function(AgeOfMarriageData) {
        var filteredData = AgeOfMarriageData
        filteredData.forEach(function(index) {
          //Check which gender data to look at
          if (Gender == 'Female') {
            var indexgender = parseInt(index['Female ']);
          } else if (Gender == 'Male') {
            var indexgender = parseInt(index['Male']);
          }
          //If number is less than the marriage chance and the marriage age hasn't already been set.
          if (MarriageChance < indexgender && MarriageAge == 101) {
            MarriageAge = index['AgeMarriage'];
            console.log('Marriage Age: ' + MarriageAge);
          }
        })
      })
    }

    function loadMyCSV1Child() {
      document.getElementById("KidsLogo").style.visibility = 'visible';
      return d3.csv('Names.csv', function(NameData) {
        NameChild1(NameData);
      })
    }

    function loadMyCSV2Child() {
      return d3.csv('Names.csv', function(NameData) {
        NameChild2(NameData);
      })
    }

    function loadMyCSV3Child() {
      return d3.csv('Names.csv', function(NameData) {
        NameChild3(NameData);
      })
    }

    var BabyChance = function() {
      var BabyChanceCSV = '';
      if (Gender == 'Female') {
        BabyChanceCSV = 'FemaleBabyChance.csv';
      } else if (Gender == 'Male') {
        BabyChanceCSV = 'MaleBabyChance.csv';
      };

      d3.csv(BabyChanceCSV, function(BabyChanceData) {
        var BabyChanceFilter = BabyChanceData.filter(function(d) {
          return (d.Age == doughnut)
        })
        var BabyChanceNum = 0;
        if (Married == true && doughnut < 47) {
          BabyChanceNum = parseInt(BabyChanceFilter[0]['Married']);
        } else if (Married == false && doughnut < 47) {
          BabyChanceNum = parseInt(BabyChanceFilter[0]['Unmarried']);
        }

        var BabyChance1 = Math.floor(Math.random() * 1000) + 1;

        if (BabyChance1 <= BabyChanceNum && howManyChildren < 3) {
          howManyChildren = howManyChildren + 1;
          howManyDependantChildren = howManyDependantChildren + 1;
          if (howManyChildren == 1) {
            Child1Doughnut = doughnut;
            //First load in CSV to stop asynchornous
            loadMyCSV1Child();
          }
          if (howManyChildren == 2) {
            Child2Doughnut = doughnut;
            //First load in CSV to stop asynchornous
            loadMyCSV2Child();
          }
          if (howManyChildren == 3) {
            Child3Doughnut = doughnut;
            //First load in CSV to stop asynchornous
            loadMyCSV3Child();
          }
        }
      })

    }

    var NameChild1 = function(NameData) {
      function genderChance() {
        return (Math.floor(Math.random() * 2) == 0) ? 'Male' : 'Female';
      }
      Child1Gender = genderChance();
      Child1Name = TheNameGame(Child1Gender, Child1Name, NameData);
      console.log('Name: ' + Child1Name);
      if (Child1Gender == 'Female') {
        document.getElementById("PopOutContent").innerHTML = 'Congratulations! You have a baby girl called ' + Child1Name + '.';
        LifeEvent();
      } else if (Child1Gender == 'Male') {
        document.getElementById("PopOutContent").innerHTML = 'Congratulations! You have a baby boy called ' + Child1Name + '.';
        LifeEvent();
      };

    }

    var NameChild2 = function(NameData) {
      function genderChance() {
        return (Math.floor(Math.random() * 2) == 0) ? 'Male' : 'Female';
      }
      Child2Gender = genderChance();
      Child2Name = TheNameGame(Child2Gender, Child2Name, NameData);
      console.log('Name: ' + Child2Name);
      if (Child2Gender == 'Female') {
        document.getElementById("PopOutContent").innerHTML = 'Congratulations! You have a baby girl called ' + Child2Name + '.';
        LifeEvent();
      } else if (Child2Gender == 'Male') {
        document.getElementById("PopOutContent").innerHTML = 'Congratulations! You have a baby boy called ' + Child2Name + '.';
        LifeEvent();
      };
    }

    var NameChild3 = function(NameData) {
      function genderChance() {
        return (Math.floor(Math.random() * 2) == 0) ? 'Male' : 'Female';
      }
      Child3Gender = genderChance();
      Child3Name = TheNameGame(Child3Gender, Child3Name, NameData);
      console.log('Name: ' + Child3Name);
      if (Child3Gender == 'Female') {
        document.getElementById("PopOutContent").innerHTML = 'Congratulations! You have a baby girl called ' + Child3Name + '.';
        LifeEvent();
      } else if (Child3Gender == 'Male') {
        document.getElementById("PopOutContent").innerHTML = 'Congratulations! You have a baby boy called ' + Child3Name + '.';
        LifeEvent();
      };
    }

    function TheNameGame(Gender, Name, NameData) {
      var NameChance1 = Math.floor(Math.random() * 100) + 1;
      NameChance1 = NameChance1.toString();
      var NameFilter = NameData.filter(function(d) {
        return (d.Rank == NameChance1)
      })
      if (Gender == 'Female') {
        Name = NameFilter[0]['NameFemale'];
        return (Name);
      } else if (Gender == 'Male') {
        Name = NameFilter[0]['NameMale'];
        return (Name);
      };
    };

    var familyDivFunction = function() {
      document.getElementById("AgeRed2").innerHTML = doughnut;
      document.getElementById("YouText").innerHTML = "Gender: " + Gender + "<br>Born in: " + AdminDistrictWard + ", " + AdminDistrictName;
      if (howManyChildren >= 1) {
        document.getElementById("Child1Div").style.backgroundColor = "#F5D662";
        document.getElementById("Child1Div").style.boxShadow = "2px 2px 3px #857435";
        document.getElementById("Child1Div").innerHTML = "<b>" + Child1Name + "</b><br>" + "Relationship: Child <br>Gender: " + Child1Gender + "<br>Age: " + (doughnut - Child1Doughnut);
      };

      if (howManyChildren >= 2) {
        document.getElementById("Child2Div").style.backgroundColor = "#F5D662";
        document.getElementById("Child2Div").style.boxShadow = "2px 2px 3px #857435";
        document.getElementById("Child2Div").innerHTML = "<b>" + Child2Name + "</b><br>" + "Relationship: Child <br>Gender: " + Child2Gender + "<br>Age: " + (doughnut - Child2Doughnut);
      };

      if (howManyChildren >= 3) {
        document.getElementById("Child3Div").style.backgroundColor = "#F5D662";
        document.getElementById("Child3Div").style.boxShadow = "2px 2px 3px #857435";
        document.getElementById("Child3Div").innerHTML = "<b>" + Child3Name + "</b><br>" + "Relationship: Child <br>Gender: " + Child3Gender + "<br>Age: " + (doughnut - Child3Doughnut);
      };

      if (Married == true) {
        document.getElementById("SpouseText").innerHTML = "<b>" + SpouseName + "</b><br>" + "Relationship: Spouse<br>Gender: " + SpouseGender + "<br>Job: " + SpouseOccupation + "<br>Salary: £" + numberComma(SpouseWage);
        if (SpouseGender == 'Female'){
          document.getElementById("SpouseDiv").style.backgroundColor = "#F4989D";
          document.getElementById("SpouseDiv").style.boxShadow = "2px 2px 3px #AF6F70";
          document.getElementById("SpouseImg").src = "girl.png";
        }
        else if (SpouseGender == 'Male'){
          document.getElementById("SpouseDiv").style.backgroundColor = "#75D1F6";
          document.getElementById("SpouseDiv").style.boxShadow = "2px 2px 3px #388CA6";
          document.getElementById("SpouseImg").src = "man.png";
        }
      }
    }

    var MarriageChanceCheck = function() {
      if (Married == false && MarriageAge == doughnut) {
        document.getElementById("PopOutContent").innerHTML = "";
        document.getElementById("TheContinueButton").style.display = "none";
        document.getElementById("MarriedChoice").style.display = "block";
        LifeChoice();
      }
    }

    var Wedding = function() {
      drawLine();
      document.getElementById("WeddingLogo").style.visibility = 'visible';
      //document.getElementById("LineChartDiv").style.display = "block";
      if (Savings > 0) {
        Savings = parseInt(Savings);
        console.log(Savings);
        document.getElementById("WeddingPriceInput").setAttribute("max", Savings);
      } else {
        document.getElementById("WeddingPriceInput").setAttribute("max", 50);
      };
      document.getElementById("WeddingPrice").style.display = "block";
      document.getElementById("MarriedChoice").style.display = "none";
    };
    var GetMarried = function() {
      document.getElementById("ChartAreaDiv2").style.display = "none";
      document.getElementById("EducationChartTitle").style.display = "none";
      console.log('SAVINGS BEFORE WEDDING: ' + Savings);
      var WeddingPrice1 = document.getElementById("WeddingPriceInput").value;
      WeddingPrice1 = parseInt(WeddingPrice1);
      Savings = Savings - WeddingPrice1;
      document.getElementById("WeddingPrice").style.display = "none";
      Married = true;
      console.log('SAVINGS AFTER WEDDING: ' + Savings);
      if ((document.getElementById("MarriedSpouseGender").value) == "Male") {
        SpouseGender = 'Male';
        console.log('Task 1');
        SpouseInformationLoad();
      } else if ((document.getElementById("MarriedSpouseGender").value) == "Female") {
        SpouseGender = 'Female';
        console.log('Task 1');
        SpouseInformationLoad();
      };
    }
    var DontMarry = function() {
      document.getElementById("TheContinueButton").style.display = "block";
      document.getElementById("MarriedChoice").style.display = "none";

      StartLife();
    };

    function loadMyCSVSpouse() {
      return d3.csv('Names.csv', function(NameData) {
        SpouseInformation(NameData);
        console.log('Task 5');
      });
    };
    var SpouseInformationLoad = function() {
      console.log('Task 2');
      loadSpouseJobCSV();

    };
    var SpouseInformation = function(NameData) {
      console.log('Task 6');
      SpouseName = TheNameGame(SpouseGender, SpouseName, NameData);
      //document.getElementById("SpouseDiv").innerHTML = "<u>" + SpouseName + "</u><br>" + "Relationship: Spouse<br>Gender: " + SpouseGender + "<br>Job: " + SpouseOccupation + "<br>Salary: " + SpouseWage;
      document.getElementById("TheContinueButton").style.display = "block";
      document.getElementById("MarriedChoice").style.display = "none";
      StartLife();
    };

    var loadSpouseJobCSV = function() {
      if (SpouseGender == 'Female') {
        //SpouseJobCSV = "JobChanceFemale.csv";
        return d3.csv('JobChanceFemale3.csv', function(SpouseWorkData) {
          //SpouseWork(SpouseWorkData);
          var AgeRangeTest = '';
          if (doughnut <= 21) {
            AgeRangeTest = '18-21';
          } else if (doughnut <= 29) {
            AgeRangeTest = '22-29';
          } else if (doughnut <= 39) {
            AgeRangeTest = '30-39';
          } else if (doughnut <= 49) {
            AgeRangeTest = '40-49';
          } else if (doughnut <= 59) {
            AgeRangeTest = '50-59';
          } else if (doughnut <= 60) {
            AgeRangeTest = '60';
          }
          console.log(SpouseWorkData);
          SpouseWork(SpouseWorkData, AgeRangeTest);
        });

      } else if (SpouseGender == "Male") {
        //SpouseJobCSV = "JobChance.csv";
        return d3.csv('JobChance5.csv', function(SpouseWorkData) {
          //SpouseWork(SpouseWorkData);
          var AgeRangeTest = '';
          if (doughnut <= 21) {
            AgeRangeTest = '18-21';
          } else if (doughnut <= 29) {
            AgeRangeTest = '22-29';
          } else if (doughnut <= 39) {
            AgeRangeTest = '30-39';
          } else if (doughnut <= 49) {
            AgeRangeTest = '40-49';
          } else if (doughnut <= 59) {
            AgeRangeTest = '50-59';
          } else if (doughnut <= 60) {
            AgeRangeTest = '60';
          }
          console.log(SpouseWorkData);
          SpouseWork(SpouseWorkData, AgeRangeTest);
        });

      };
    };

    var SpouseWork = function(SpouseWorkData, AgeRangeTest) {
      //console.log(SpouseJobFilter);
      console.log(SpouseWorkData);
      console.log('SPOILER');
      var chance = Math.floor((Math.random() * 100) + 1);

      SpouseWorkData.forEach(function(index) {
        var PercentageAdded1 = parseInt(index['PercentageAdded']);
        var indexAgeRange = index['AgeRange'];
        console.log(chance);
        console.log(PercentageAdded1);
        console.log(indexAgeRange + AgeRangeTest);
        if (chance <= PercentageAdded1 && AgeRangeTest == indexAgeRange) {
          SpouseWage = index['MedianAnnualWage'];
          SpouseWage = parseInt(SpouseWage);
          SpouseOccupation = index['Occupation'];
          loadMyCSVSpouse();
        } else {
          console.log('NOOOOOOOOOOOOOO.');
          //SpouseWork(SpouseWorkData, AgeRangeTest);
        };
      });

    };






    var CheckSpouseSalary = function() {
      var JobCSV = '';
      if (Gender === "Male") {
        JobCSV = "JobChance5.csv";
      } else if (Gender === "Female") {
        JobCSV = "JobChanceFemale3.csv";
      }

      d3.csv(JobCSV, function(JobChanceData) {
        var AgeRangeTest = '';
        var AgeRangeTest10 = '';
        if (doughnut <= 21) {
          AgeRangeTest = '18-21';
          AgeRangeTest10 = '22-29';
        } else if (doughnut <= 29) {
          AgeRangeTest = '22-29';
          AgeRangeTest10 = '30-39';
        } else if (doughnut <= 39) {
          AgeRangeTest = '30-39';
          AgeRangeTest10 = '40-49';
        } else if (doughnut <= 49) {
          AgeRangeTest = '40-49';
          AgeRangeTest10 = '50-59';
        } else if (doughnut <= 59) {
          AgeRangeTest = '50-59';
          AgeRangeTest10 = '60';
        } else if (doughnut <= 60) {
          AgeRangeTest = '60';
          AgeRangeTest10 = '60';
        }

        var lessThan1 = JobChanceData.filter(function(d) {
          return (d.Occupation == SpouseOccupation)
        });

        lessThan1.forEach(function(index) {
          if (index['AgeRange'] == AgeRangeTest10) {
            Salary10 = index['MedianAnnualWage'];
            Salary10 = parseInt(Salary10);
            console.log(Salary10 + ' SALARY10');
          }
        })

        lessThan1.forEach(function(index) {
          if (index['AgeRange'] == AgeRangeTest) {
            if (doughnut <= 21) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              SpouseWage = parseInt(SpouseWage) + parseInt(SalaryDifference);
              if (doughnut == 21) {
                SpouseWage = SalaryActual;
              }
            } else if (doughnut <= 29) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              SpouseWage = parseInt(SpouseWage) + parseInt(SalaryDifference);
              if (doughnut == 29) {
                SpouseWage = SalaryActual;
              }
            } else if (doughnut <= 39) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              SpouseWage = parseInt(SpouseWage) + parseInt(SalaryDifference);
              if (doughnut == 39) {
                SpouseWage = SalaryActual;
              }
            } else if (doughnut <= 49) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              SpouseWage = parseInt(SpouseWage) + parseInt(SalaryDifference);
              if (doughnut == 49) {
                SpouseWage = SalaryActual;
              }
            } else if (doughnut <= 59) {
              var SalaryActual = index['MedianAnnualWage'];
              var SalaryDifference = (Salary10 - SalaryActual) / 10;
              SpouseWage = parseInt(SpouseWage) + parseInt(SalaryDifference);
              if (doughnut == 59) {
                SpouseWage = SalaryActual;
              }
            } else if (doughnut <= 60) {
              var SalaryActual = index['MedianAnnualWage'];
              SpouseWage = SalaryActual;
              if (68 <= doughnut) {
                SpouseWage = parseInt(SpouseWage) + 8296;
              }
            }
            console.log(SpouseWage + ' SALARY');
          };
        });
      });
    };

    var SpouseTaxCalculator = function() {
      var IncomeTaxableWage = parseInt(SpouseWage) - 11000;

      var IncomeTax = 0;
      var NationalInsurance = 0;
      var StudentLoan = 0;
      if (IncomeTaxableWage < 32001) {
        IncomeTax = IncomeTaxableWage * 0.2;
      } else if (IncomeTaxableWage < 150000) {
        IncomeTax = (32000 * 0.2) + ((IncomeTaxableWage - 32000) * 0.4)
      }

      if (Salary > 8163 && Salary < 45001) {
        NationalInsurance = (Salary - 8163) * 0.12;
      } else if (Salary > 45000) {
        var NITaxableSalary = Salary - 8163;
        NationalInsurance = (36837 * 0.12) + ((NITaxableSalary - 36837) * 0.2)
      } else if (StudentLoanTotal < 0 && WentToUniversity == true && StudentLoanFinished == false) {
        StudentLoan = 0;
        console.log('Paid off student loan.');
        document.getElementById("PopOutContent").innerHTML = "You paid off your student loan!"
        StudentLoanFinished = true;
        LifeEvent();

      } else if (doughnut > 51 && WentToUniversity == true && StudentLoanFinished == false) {
        StudentLoan = 0;
        StudentLoanFinished = true;
        console.log('After 30 years your student loan was wiped out, with £' + Math.round(StudentLoanTotal) + ' left unpaid.');
        document.getElementById("PopOutContent").innerHTML = 'After 30 years your student loan was wiped out, with £' + Math.round(StudentLoanTotal) + ' left unpaid.'
        LifeEvent();
      }
      SpouseWageAfterTax = SpouseWage - NationalInsurance - IncomeTax;
      SpouseWageAfterTax = Math.round(WageAfterTax);
      console.log('Wage after tax: ' + WageAfterTax);
    };

    var SpousePensionFunds = function() {
      //Okay we need to find the max percentage that they can spend. Lets go.
      if (Remaining > 0) {
        //Find the max percentage someone can pay on pension.
        spouseMaxPercentagePension = (Remaining / SpouseWage) * 100;
        spouseMaxPercentagePension = 10;

        //Set max value and show pension input form
        //var input = document.getElementById("PercentagePensionInput");
        //input.setAttribute("max", spouseMaxPercentagePension);
        //document.getElementById("PercentagePensionInputForm").style.display = "block";

        //Find out how much pension is taken.
        SpouseyearlyPensionContribution = SpouseWage * (spouseMaxPercentagePension / 100)
        SpousePensionPot = SpousePensionPot + (SpouseyearlyPensionContribution * 2);
        SpousePensionPot = Math.round(SpousePensionPot);
      } else if (Remaining < 0) {
        spouseMaxPercentagePension = 0;
      }

      var ExpRent = parseInt(Expenses) + parseInt(Rent);
      YearsLeft = parseInt(FinalAgeDeath) - doughnut;
      var MoneyNeededToRetire = ExpRent + YearsLeft;
      var TotalGovernmentPension = (parseInt(FinalAgeDeath) - 68) * 8296;
      var PensionPotAndGov = TotalGovernmentPension + SpousePensionPot;
      SpousePensionPerYear = PensionPotAndGov / YearsLeft;
      SpousePensionPerYearAfterTax = 0

      var PensionPerYearTaxable = SpousePensionPerYear - 11000;
      var PensionPerYearTaxable25 = PensionPerYearTaxable * 0.25
      if (PensionPerYearTaxable < 32001) {
        SpousePensionPerYearAfterTax = PensionPerYearTaxable25 + 11000 + PensionPerYearTaxable - (PensionPerYearTaxable * 0.2);
      } else if (PensionPerYearTaxable < 150000) {
        SpousePensionPerYearAfterTax = PensionPerYearTaxable25 + 11000 + PensionPerYearTaxable - ((32000 * 0.2) + ((PensionPerYearTaxable - 32000) * 0.4));
      }
      SpousePensionPerYearAfterTax = Math.round(SpousePensionPerYearAfterTax);
      console.log(ExpRent);

      if (SpousePensionPerYearAfterTax >= (SpouseWageAfterTax * 0.75) && doughnut > 55 && blocker2 != 1) {
        //RetireButton to PopOutContent
        document.getElementById("PopOutContent").innerHTML = 'Your spouse has been paying 10% of their salary into their pension each year, so with a pension pot of £' + numberComma(SpousePensionPot) + ' retires on £' + numberComma(
          SpousePensionPerYearAfterTax) + ' a year at age ' + doughnut + '.';
        SpouseOccupation = 'Retired';
        Spouseblocker2 = 1;
        SpouseRetirementTrue = true;
        LifeEvent();

      };

    };

    var MoveArea = function() {
      console.log(rentFilter);
      console.log(RentCostData1);
      var RegionIs = rentFilter[0]['RegionCode'];

    }

    var VisitEstateAgents = function() {
      document.getElementById('ExpensesTooHigh').style.display = 'none';
      document.getElementById("EstateAgents").style.display = "block";
      document.getElementById("PopOutContent").innerHTML = "";

      if (Remaining > 0 && Rent == 0) {
        document.getElementById("ExpensesTooHigh").innerHTML = "Your parents want your room back, choose whether or not to move!";
        document.getElementById('ExpensesTooHigh').style.display = 'block';
      }
      if (Remaining < 0 && Savings < 0) {
        document.getElementById("ExpensesTooHigh").innerHTML = "Your expenses are too high, you need to move house!";
        document.getElementById('ExpensesTooHigh').style.display = 'block';
      }
      LifeChoice();
    }

    function drawLine() {
      var margin = {
        top: 10,
        right: 50,
        bottom: 20,
        left: 50
      }

      document.getElementById("EducationChartTitle").innerHTML = "<b>Percent of Married People by Age</b>";
      var width = parseInt(d3.select("#ChartAreaDiv2").style("width")) - margin.left - margin.right;
      var height = 200 - margin.top - margin.bottom;

      var x = d3.scaleLinear().range([0, width]);
      var y = d3.scaleLinear().range([height, 0]);

      //Values For Genre Lines
      var FemaleLine = d3.line()
        .x(function(d) {
          return x(d.AgeMarriage);
        })
        .y(function(d) {
          return y(d.Female);
        });
      var MaleLine = d3.line()
        .x(function(d) {
          return x(d.AgeMarriage);
        })
        .y(function(d) {
          return y(d.Male);
        });


      //Appending svg with chart to #chart
      var svg = d3.select("#ChartAreaDiv2").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")")
        .attr("margin", margin);

      var tooltip = d3.select('#ChartAreaDiv2')
        .append('div')
        .attr('class', 'tooltip');
      var AmountOfStuff = 0;
      var DotColour = '';
      d3.csv("AgeOfMarriage2.csv", function(error, data) {
        if (error) throw error;
        data.forEach(function(d) {
          d.AgeMarriage = parseInt(d.AgeMarriage);
          d.Male = +d.Male;
          d.Female = +d.Female;
          d.Male = d.Male / 10;
          d.Female = d.Female / 10;
          if (d.AgeMarriage == MarriageAge) {
            if (Gender == 'Female') {
              AmountOfStuff = d.Female;
              DotColour = '#F8CFD7';
            } else if (Gender == 'Male') {
              AmountOfStuff = d.Male;
              DotColour = '#BDCBDB';
            };
          }

        });
        console.log(data);

        x.domain(d3.extent(data, function(d) {
          return d.AgeMarriage;
        }));
        y.domain([0, d3.max(data, function(d) {
          //Female has the highest points.
          return d.Female;
        })]);
        //Adding each of the Gender Paths
        svg.append("path")
          .data([data])
          .attr("class", "line")
          .attr("fill", "none")
          .attr("stroke", "#F8CFD7")
          .attr("stroke-width", "2px")
          .style("opacity", 1)
          .attr("d", FemaleLine);

        svg.append("path")
          .data([data])
          .attr("class", "line")
          .attr("fill", "none")
          .attr("stroke", "#BDCBDB")
          .attr("stroke-width", "2px")
          .style("opacity", 1)
          .attr("d", MaleLine);

        svg.selectAll("dot")
          .data([data])
          .enter().append("circle")
          .attr("fill", DotColour)
          .attr("r", 7)
          .attr("cx", function(d) {
            return x(MarriageAge)
          })
          .attr("cy", function(d) {
            return y(AmountOfStuff);
          });

        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        svg.append("g")
          .call(d3.axisLeft(y).ticks(5));

      });
    };

    var AfterLife = function(){
      document.getElementById('AfterLifeEducationText').appendChild(document.getElementById('ChartAreaDiv'));
      document.getElementById('ChartAreaDiv').style.display = 'block';

      var FurtherEducation = 92;
      var EmploymentOrTraining = 5;
      var NotInEducationOrWork = 3;

      var FurtherEducation = parseInt(FurtherEducation);
      var EmploymentOrTraining = parseInt(EmploymentOrTraining);
      var NotInEducationOrWork = parseInt(NotInEducationOrWork);

      var margin = {
        top: 60,
        right: 70,
        bottom: 40,
        left: 70
      }


      //var width = parseInt(d3.select("#ChartAreaDiv3").style("width")) - margin.left - margin.right;
      var width = EducationWidth;
      console.log("Width is:" + width);
      var height = 145 - margin.top - margin.bottom;
      var data = [{
        "Percentage": (FurtherEducation + EmploymentOrTraining + NotInEducationOrWork),
        "Name": "FurtherEducation"
      }, {
        "Percentage": (EmploymentOrTraining + NotInEducationOrWork),
        "Name": "EmploymentOrTraining"
      }, {
        "Percentage": NotInEducationOrWork,
        "Name": "NotInEducationOrWork"
      }]; // here are the data values; v1 = total, v2 = current value
      var data1 = [FurtherEducation, EmploymentOrTraining, NotInEducationOrWork];
      var chart = d3.select("#ChartAreaDiv3").append("svg") // creating the svg object inside the container div
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")")
        .attr("margin", margin);

      var x = d3.scaleLinear() // takes the fixed width and creates the percentage from the data values
        .domain([0, d3.max(data, function(d) {
          return d.Percentage;
        })])
        .range([0, width]);

      var x1 = d3.scaleLinear() // takes the fixed width and creates the percentage from the data values
        .domain([0, d3.max(data1, function(d) {
          return d.Percentage;
        })])
        .range([0, width]);

      var a = ['#9CDAB3', '#F5AD9D', '#82AEDF'];

      var defs = chart.append("defs")
      var pattern = chart.append("pattern")
        .data(data)
        .enter()
        .selectAll("pattern")
        .attr('id', "hash4_4")
        .attr('width', "7")
        .attr('height', "7")
        .attr('patternUnits', "userSpaceOnUse")
        .attr('patternTransform', "rotate(45)")
        .append("rect")
        .attr('width', "4")
        .attr('height', "8")
        .attr('transform', "translate(0,0)")
        .attr('fill', "white")
        .style('opacity', 1)

      chart.selectAll("myrect") // this is what actually creates the bars
        .data(data)
        .enter().append("rect")
        .attr('class', 'myrect')
        .attr("width", function(d) { // sets the x position of the bar
          return x(d.Percentage);
        })
        .attr("fill", function(d, i) {
          return a[i]
        })
        .attr("height", 30)
        .attr("rx", 6) // rounded corners
        .attr("ry", 6);

      chart.selectAll("myrect") // this is what colors in the bar
        .data(data)
        .enter()
        .append("rect")
        .attr('class', 'myrect')
        .attr("width", function(d) {
          return x(d.Percentage);
        })
        .attr("height", 30)
        .attr("rx", 6)
        .attr("ry", 6)
        .attr('fill', "url(#hash4_4)")
        .attr('id', function(d, i) {
          return d['Name']
        })

      chart.selectAll("text") // adding the text labels to the bar
        .data(data)
        .enter().append("text")
        .attr("x", function(d) { // sets the x position of the bar
          return x(d.Percentage);
        })
        .attr("y", 15) // y position of the text inside bar
        .attr("dx", -15) // padding-right
        .attr("dy", ".42em") // vertical-align: middle
        .attr("text-anchor", "middle") // text-align: right
        .style("font-weight", "bold")
        .style("font-size", "1.25em")
        .data(data1)
        .text(String);

      chart.append("line")
        .attr("x1", 0)
        .attr("y1", 15)
        .attr("x2", -10)
        .attr("y2", 15)
        .attr("stroke-width", 2)
        .attr("stroke", "grey");

      chart.append("foreignObject")
        .attr("x", -70)
        .attr("y", -10)
        .attr("width", 45)
        .attr("height", 100)
        .append("xhtml:ChartAreaDiv3")
        .style("font-weight", "bold")
        .style("font-size", "0.74em")
        .style("color", "grey")
        .html("Not in education or work");


      chart.append("line")
        .attr("x1", width)
        .attr("y1", 15)
        .attr("x2", width + 15)
        .attr("y2", 15)
        .attr("stroke-width", 2)
        .attr("stroke", "grey");

      chart.append("foreignObject")
        .attr("x", width + 17)
        .attr("y", -10)
        .attr("width", 45)
        .attr("height", 100)
        .append("xhtml:ChartAreaDiv3")
        .style("font-weight", "bold")
        .style("font-size", "0.74em")
        .style("color", "grey")
        .html("In education");


      //THIS ONE NEEDS TO BE MADE SO ITS X CHANGES TO CENTER OF BAR
      chart.append("line")
        .attr("x1", 40)
        .attr("y1", 30)
        .attr("x2", 40)
        .attr("y2", 45)
        .attr("stroke-width", 2)
        .attr("stroke", "grey");

      chart.append("foreignObject")
        .attr("x", 20)
        .attr("y", 50)
        .attr("width", 150)
        .attr("height", 100)
        .append("xhtml:ChartAreaDiv3")
        .style("font-weight", "bold")
        .style("font-size", "0.74em")
        .style("color", "grey")
        .html("Employment or training");

    //Here we look at the University Box and what needs  to go into there.
    var WalesUniExplainer = '';
    console.log('Hey');
    if (Country == 'Wales'){
      WalesUniExplainer = '<br><br>NOTE: Figures for Welsh University are only intended for use in the game as they are basic estimates based on how many people in the areas go to university. This is because the data of where they go to university is not published in Wales as it is in England.'
    }

    if (UniPoints == 3) {
      document.getElementById("AfterLifeUniText").innerHTML = "You went to Oxford or Cambridge University!" + "In your area " + Oxbridge + "% of KS5 leavers got into university in Oxford or Cambridge, while " +
        TopThirdHEI + "% in your area went to a university in the top third of university rankings, 25% did overall in England. In your area there were " + OtherHE + "% who went to other higher education institutes, while 34% did overall in England." + WalesUniExplainer;
        console.log('Hey');
    } else if (UniPoints == 2) {
      document.getElementById("AfterLifeUniText").innerHTML = "You went to a university ranked in the top third! " + "In your area " + Oxbridge + "% of KS5 leavers got into university in Oxford or Cambridge, while " +
        TopThirdHEI + "% in your area went to a university in the top third of university rankings, 25% did overall in England. In your area there were " + OtherHE + "% who went to other higher education institutes, while 34% did overall in England." + WalesUniExplainer;
        console.log('Hey');

    } else if (UniPoints == 1) {
      document.getElementById("AfterLifeUniText").innerHTML = "You went to a univeristy that wasn't ranked in the top third." + "In your area " + Oxbridge + "% of KS5 leavers got into university in Oxford or Cambridge, while " +
        TopThirdHEI + "% in your area went to a university in the top third of university rankings, 25% did overall in England. In your area there were " + OtherHE + "% who went to other higher education institutes, while 34% did overall in England." + WalesUniExplainer;
        console.log('Hey');
    }
    else {
      document.getElementById("AfterLifeUniText").innerHTML = "You didn't go onto University. In your area " + Oxbridge + "% of KS5 leavers got into university in Oxford or Cambridge, while " +
        TopThirdHEI + "% in your area went to a university in the top third of university rankings, 25% did overall in England. In your area there were " + OtherHE + "% who went to other higher education institutes, while 34% did overall in England." + WalesUniExplainer;
        console.log('Hey');
      };


    //Now Lets Look at the Summary for Work

    document.getElementById("AfterLifeWorkTextArea").innerHTML = "Throughout your working career there was a " + WageDifference + "% difference between your wages working in " + LA + " and the rest of England and Wales."

    DrawLineJobArea();

    document.getElementById("AfterLifeDeathText").innerHTML = "Your chance of death at a certain age by a certain cause is determined by two things. First being " + Gender + " and the multiple depravation index of your area which is " + IMD + ", with the most deprived areas in the UK have an index of 1 and the least deprived having an index of 10."
    }

    var DrawLineJobArea = function(){
      var JobGenderCSV = '';

      if (Job == 'Administrative and secretarial'){
        JobGenderCSV = 'CompareAdminAndSecretorial.csv'
      }

      if (Job == 'Associate professional and technical'){
        JobGenderCSV = 'CompareAssociateProfessionalAndTechnical.csv'
      }

      if (Job == 'Caring, leisure and other services'){
        JobGenderCSV = 'CompareCaringLeisure.csv'
      }

      if (Job == 'Managers, directors and senior officials'){
        JobGenderCSV = 'CompareManagersDirectors.csv'
      }

      if (Job == 'Process, plant and machine operatives'){
        JobGenderCSV = 'CompareProcessPlantMachine.csv'
      }

      if (Job == 'Professional jobs'){
        JobGenderCSV = 'CompareProfessionalJobs.csv'
      }

      if (Job == 'Sales and customer service'){
        JobGenderCSV = 'CompareSales.csv'
      }

      if (Job == 'Service, Administration and Trades'){
        JobGenderCSV = 'CompareService.csv'
      }



      var margin = {
        top: 10,
        right: 50,
        bottom: 20,
        left: 50
      }

      //var width = parseInt(d3.select("#AfterLifeWorkTextArea").style("width")) - margin.left - margin.right;
      var width = EducationWidth;
      var height = 200 - margin.top - margin.bottom;

      var x = d3.scaleLinear().range([0, width]);
      var y = d3.scaleLinear().range([height, 0]);

      //Values For Genre Lines
      var FemaleLine = d3.line()
        .x(function(d) {
          return x(d.Age);
        })
        .y(function(d) {
          return y(d.Female);
        });
      var MaleLine = d3.line()
        .x(function(d) {
          return x(d.Age);
        })
        .y(function(d) {
          return y(d.Male);
        });


      //Appending svg with chart to #chart
      var svg = d3.select("#AfterLifeWorkTextAreaGraph").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")")
        .attr("margin", margin);

      var tooltip = d3.select('#AfterLifeWorkTextArea')
        .append('div')
        .attr('class', 'tooltip');
      var AmountOfStuff = 0;
      d3.csv(JobGenderCSV, function(error, data) {
        if (error) throw error;
        data.forEach(function(d) {
          d.Age = parseInt(d.Age);
          d.Male = +d.Male;
          d.Female = +d.Female;

        });
        console.log(data);

        x.domain(d3.extent(data, function(d) {
          return d.Age;
        }));
        y.domain([0, d3.max(data, function(d) {
          //Female has the highest points.
          return d.Male;
        })]);
        //Adding each of the Gender Paths
        svg.append("path")
          .data([data])
          .attr("class", "line")
          .attr("fill", "none")
          .attr("stroke", "#F8CFD7")
          .attr("stroke-width", "2px")
          .style("opacity", 1)
          .attr("d", FemaleLine);

        svg.append("path")
          .data([data])
          .attr("class", "line")
          .attr("fill", "none")
          .attr("stroke", "#BDCBDB")
          .attr("stroke-width", "2px")
          .style("opacity", 1)
          .attr("d", MaleLine);

        svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

        svg.append("g")
          .call(d3.axisLeft(y).ticks(5));
      });
    }
  </script>
</body>
